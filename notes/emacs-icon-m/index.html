<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/images/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/github.min.css" />
    <meta http-equiv="content-security-policy" content=""><title>Emacs: ファイル名補完で「Icon^M」を無視する - 2014-12-17 | 葉月夜堂</title><link href="https://twitter.com/p_km" rel="me" data-svelte="svelte-10crdf0">
    <link rel="webmention" href="https://webmention.io/sveltekit-prerender/webmention" data-svelte="svelte-10crdf0">
    <link rel="pingback" href="https://webmention.io/sveltekit-prerender/xmlrpc" data-svelte="svelte-10crdf0"><meta property="og:type" content="article" data-svelte="svelte-6t30ru"><meta property="og:title" content="Emacs: ファイル名補完で「Icon^M」を無視する - 2014-12-17 | 葉月夜堂" data-svelte="svelte-6t30ru"><meta property="og:description" content="Emacsではfind-fileなどでのファイル名補完で特定の拡張子のファイルを候補に含まないように設定できる．たとえば.xlsxファイルをEmacsで開くことは普段はあまりないだろう．(setq completion-ignored-extensions       (append completion-ignored-extensions               &amp;#x27;(&amp;quot;./&amp;quot; &amp;quot;../&amp;quot; &amp;quot;.xlsx&amp;quot;)))(defadvice completion-file-name-table (after ignoring-backups-f-n-completion activate)  &amp;quot;filter out results when the have completion-ignored-extensions&amp;quot;  (let ((res ad-return-value))    (if (and (listp res)             (stringp (car res))          (cdr res)" data-svelte="svelte-6t30ru"><meta property="og:site_name" content="葉月夜堂" data-svelte="svelte-6t30ru"><meta property="og:image" content="http://sveltekit-prerender/images/favicon.svg" data-svelte="svelte-6t30ru">
	<link rel="stylesheet" href="/_app/immutable/assets/pages/__layout.svelte-00878b0d.css">
	<link rel="stylesheet" href="/_app/immutable/assets/time.svelte_svelte_type_style_lang-61ea3f89.css">
	<link rel="stylesheet" href="/_app/immutable/assets/pages/_...entity_.svelte-f6db877a.css">
	<link rel="modulepreload" href="/_app/immutable/start-17368dfa.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/index-7416df8b.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/singletons-d1fb5791.js">
	<link rel="modulepreload" href="/_app/immutable/pages/__layout.svelte-0c722760.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/time.svelte_svelte_type_style_lang-2ab901cd.js">
	<link rel="modulepreload" href="/_app/immutable/pages/_...entity_.svelte-46a52835.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/tags-f0769dcf.js">
  </head>
  <body>
    <div>




<nav><ul><li><a sveltekit:prefetch href="/">葉月夜堂</a>
      </li><li><a sveltekit:prefetch href="/about">about</a>
      </li></ul></nav>



<div class="nav-background svelte-1dwb7hb isHeaderInView" style=""></div>

<main><article data-kind="note" class="svelte-1dwb7hb"><header class="svelte-1dwb7hb"><h1 class="svelte-1dwb7hb">Emacs:<wbr> ファイル名補完で<wbr>「Icon^M」を<wbr>無視する</h1>

      

      <section class="meta svelte-1dwb7hb"><p class="svelte-1dwb7hb"><time title="7 年半前" class="svelte-5ni4x2">Tue Dec 16 2014 22:21:21 GMT+0000 (Coordinated Universal Time)</time></p>

        <p class="svelte-1dwb7hb"><a href="https://github.com/kissge/yo.eki.do/commits/master/notes/emacs-icon-m.md" class="svelte-1dwb7hb">更新履歴</a></p></section>

      

      

      <section class="header-image svelte-1dwb7hb" style=""></section></header>

    <section class="body svelte-1dwb7hb"><!-- HTML_TAG_START --><p>Emacsでは<code>find-file</code>などでのファイル名補完で特定の拡張子のファイルを候補に含まないように設定できる．
たとえば.xlsxファイルをEmacsで開くことは普段はあまりないだろう．</p>
<!--more-->

<pre><code class="language-lisp">(<span class="hljs-name">setq</span> completion-ignored-extensions
      (<span class="hljs-name">append</span> completion-ignored-extensions
              &#x27;(<span class="hljs-string">&quot;./&quot;</span> <span class="hljs-string">&quot;../&quot;</span> <span class="hljs-string">&quot;.xlsx&quot;</span>)))
(<span class="hljs-name">defadvice</span> completion-file-name-table (<span class="hljs-name">after</span> ignoring-backups-f-n-completion activate)
  <span class="hljs-string">&quot;filter out results when the have completion-ignored-extensions&quot;</span>
  (<span class="hljs-name">let</span> ((<span class="hljs-name">res</span> ad-return-value))
    (<span class="hljs-name">if</span> (<span class="hljs-name">and</span> (<span class="hljs-name">listp</span> res)
             (<span class="hljs-name">stringp</span> (<span class="hljs-name">car</span> res))
          (<span class="hljs-name">cdr</span> res)) <span class="hljs-comment">; length &gt; 1, don&#x27;t ignore sole match</span>
        (<span class="hljs-name">setq</span> ad-return-value
              (<span class="hljs-name">completion-pcm--filename-try-filter</span> res)))))
</code></pre>
<p>（参考：<a href="http://stackoverflow.com/questions/1731634/dont-show-uninteresting-files-in-emacs-completion-window">autocomplete - Don’t show uninteresting files in Emacs completion window - Stack Overflow</a>，Emacsのバージョンによって微妙にどこかを変えなければいけなかったような気がするけど忘れた）</p>
<p>で，マッキントッシュというオーエスでは<strong>油断すると</strong>「Icon\r」（\rは制御文字のCR, 0x0d）という名前のファイルが勝手に作られることがある（「Icon?」「Icon^M」に見える場合もあるだろう）．
普段は見えないので気にならないが，<strong>油断すると</strong>，例えばDropboxがヘマをすると見えるようになっていて，CRが含まれているせいで非常に邪魔だ．消したい．</p>
<p>が，<code>completion-ignored-extensions</code>にそのまま<code>"Icon\r"</code>とか<code>"Icon\r"</code>とか書いてもうまくいかない．
何故ならばEmacsが自動的に<code>\r</code>を<code>\n</code>に変換してくれているからである．</p>
<p>このことは次のようにすると確かめられる．</p>
<pre><code class="language-lisp">(<span class="hljs-name">car</span> (<span class="hljs-name">file-name-all-completions</span> <span class="hljs-string">&quot;Icon&quot;</span> <span class="hljs-string">&quot;~/Dropbox/&quot;</span>))
=&gt; <span class="hljs-string">&quot;Icon
&quot;</span>

(<span class="hljs-name">string=</span> <span class="hljs-string">&quot;Icon\n&quot;</span> (<span class="hljs-name">car</span> (<span class="hljs-name">file-name-all-completions</span> <span class="hljs-string">&quot;Icon&quot;</span> <span class="hljs-string">&quot;~/Dropbox/&quot;</span>)))
=&gt; <span class="hljs-literal">t</span>
</code></pre>
<p>（注．最後の<code>~/Dropbox/</code>を適当にIconからファイル名が始まるファイルがIcon\rしかないディレクトリに変える）</p>
<p>と，いうわけで<code>completion-ignored-extensions</code>には<code>"Icon\n"</code>を追加すればよい．</p>
<!-- HTML_TAG_END --></section>

    

    <section class="mentions svelte-19gm1ik"><section class="reaction svelte-19gm1ik"><a href="https://twitter.com/intent/tweet?url=" class="svelte-19gm1ik" style="background-image: url(/_app/immutable/assets/message-circle-c0b45d48.svg); color: #3579d1;"><small class="svelte-19gm1ik">Twitterで</small>
        <span class="svelte-19gm1ik">コメントする</span></a></section>

  <h1 class="svelte-19gm1ik">Mentions</h1>
  <ol reversed class="svelte-19gm1ik loading"></ol>
</section></article>
</main>

<footer>Built with <a href="https://github.com/kissge/monolog">monolog</a>
</footer>


		<script type="module" data-sveltekit-hydrate="9twmjx">
		import { start } from "/_app/immutable/start-17368dfa.js";
		start({
			target: document.querySelector('[data-sveltekit-hydrate="9twmjx"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "always",
			hydrate: {
				status: 200,
				error: null,
				nodes: [0, 2],
				params: {entity:"notes\u002Femacs-icon-m\u002F"},
				routeId: "[...entity]"
			}
		});
	</script><script type="application/json" sveltekit:data-type="props">{"entity":{"name":"Emacs: ファイル名補完で「Icon^M」を無視する","nameSegmented":["Emacs:"," ファイル名補完で","「Icon^M」を","無視する"],"kind":"note","urlPath":"/notes/emacs-icon-m","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/notes/emacs-icon-m.md","lastModified":"2022-04-17T12:08:43.000Z","attributes":{"from":"wordpress","title":"Emacs: ファイル名補完で「Icon^M」を無視する","date":"2014-12-16T22:21:21.000Z"},"tags":[],"body":"\u003Cp>Emacsでは\u003Ccode>find-file\u003C/code>などでのファイル名補完で特定の拡張子のファイルを候補に含まないように設定できる．\nたとえば.xlsxファイルをEmacsで開くことは普段はあまりないだろう．\u003C/p>\n\u003C!--more-->\n\n\u003Cpre>\u003Ccode class=\"language-lisp\">(\u003Cspan class=\"hljs-name\">setq\u003C/span> completion-ignored-extensions\n      (\u003Cspan class=\"hljs-name\">append\u003C/span> completion-ignored-extensions\n              &#x27;(\u003Cspan class=\"hljs-string\">&quot;./&quot;\u003C/span> \u003Cspan class=\"hljs-string\">&quot;../&quot;\u003C/span> \u003Cspan class=\"hljs-string\">&quot;.xlsx&quot;\u003C/span>)))\n(\u003Cspan class=\"hljs-name\">defadvice\u003C/span> completion-file-name-table (\u003Cspan class=\"hljs-name\">after\u003C/span> ignoring-backups-f-n-completion activate)\n  \u003Cspan class=\"hljs-string\">&quot;filter out results when the have completion-ignored-extensions&quot;\u003C/span>\n  (\u003Cspan class=\"hljs-name\">let\u003C/span> ((\u003Cspan class=\"hljs-name\">res\u003C/span> ad-return-value))\n    (\u003Cspan class=\"hljs-name\">if\u003C/span> (\u003Cspan class=\"hljs-name\">and\u003C/span> (\u003Cspan class=\"hljs-name\">listp\u003C/span> res)\n             (\u003Cspan class=\"hljs-name\">stringp\u003C/span> (\u003Cspan class=\"hljs-name\">car\u003C/span> res))\n          (\u003Cspan class=\"hljs-name\">cdr\u003C/span> res)) \u003Cspan class=\"hljs-comment\">; length &gt; 1, don&#x27;t ignore sole match\u003C/span>\n        (\u003Cspan class=\"hljs-name\">setq\u003C/span> ad-return-value\n              (\u003Cspan class=\"hljs-name\">completion-pcm--filename-try-filter\u003C/span> res)))))\n\u003C/code>\u003C/pre>\n\u003Cp>（参考：\u003Ca href=\"http://stackoverflow.com/questions/1731634/dont-show-uninteresting-files-in-emacs-completion-window\">autocomplete - Don’t show uninteresting files in Emacs completion window - Stack Overflow\u003C/a>，Emacsのバージョンによって微妙にどこかを変えなければいけなかったような気がするけど忘れた）\u003C/p>\n\u003Cp>で，マッキントッシュというオーエスでは\u003Cstrong>油断すると\u003C/strong>「Icon\\r」（\\rは制御文字のCR, 0x0d）という名前のファイルが勝手に作られることがある（「Icon?」「Icon^M」に見える場合もあるだろう）．\n普段は見えないので気にならないが，\u003Cstrong>油断すると\u003C/strong>，例えばDropboxがヘマをすると見えるようになっていて，CRが含まれているせいで非常に邪魔だ．消したい．\u003C/p>\n\u003Cp>が，\u003Ccode>completion-ignored-extensions\u003C/code>にそのまま\u003Ccode>\"Icon\\r\"\u003C/code>とか\u003Ccode>\"Icon\\r\"\u003C/code>とか書いてもうまくいかない．\n何故ならばEmacsが自動的に\u003Ccode>\\r\u003C/code>を\u003Ccode>\\n\u003C/code>に変換してくれているからである．\u003C/p>\n\u003Cp>このことは次のようにすると確かめられる．\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-lisp\">(\u003Cspan class=\"hljs-name\">car\u003C/span> (\u003Cspan class=\"hljs-name\">file-name-all-completions\u003C/span> \u003Cspan class=\"hljs-string\">&quot;Icon&quot;\u003C/span> \u003Cspan class=\"hljs-string\">&quot;~/Dropbox/&quot;\u003C/span>))\n=&gt; \u003Cspan class=\"hljs-string\">&quot;Icon\n&quot;\u003C/span>\n\n(\u003Cspan class=\"hljs-name\">string=\u003C/span> \u003Cspan class=\"hljs-string\">&quot;Icon\\n&quot;\u003C/span> (\u003Cspan class=\"hljs-name\">car\u003C/span> (\u003Cspan class=\"hljs-name\">file-name-all-completions\u003C/span> \u003Cspan class=\"hljs-string\">&quot;Icon&quot;\u003C/span> \u003Cspan class=\"hljs-string\">&quot;~/Dropbox/&quot;\u003C/span>)))\n=&gt; \u003Cspan class=\"hljs-literal\">t\u003C/span>\n\u003C/code>\u003C/pre>\n\u003Cp>（注．最後の\u003Ccode>~/Dropbox/\u003C/code>を適当にIconからファイル名が始まるファイルがIcon\\rしかないディレクトリに変える）\u003C/p>\n\u003Cp>と，いうわけで\u003Ccode>completion-ignored-extensions\u003C/code>には\u003Ccode>\"Icon\\n\"\u003C/code>を追加すればよい．\u003C/p>\n","headline":"Emacsではfind-fileなどでのファイル名補完で特定の拡張子のファイルを候補に含まないように設定できる．たとえば.xlsxファイルをEmacsで開くことは普段はあまりないだろう．(setq completion-ignored-extensions       (append completion-ignored-extensions               &#x27;(&quot;./&quot; &quot;../&quot; &quot;.xlsx&quot;)))(defadvice completion-file-name-table (after ignoring-backups-f-n-completion activate)  &quot;filter out results when the have completion-ignored-extensions&quot;  (let ((res ad-return-value))    (if (and (listp res)             (stringp (car res))          (cdr res)","links":{"to":{"urlPath":"/notes/emacs-icon-m","entities":[]},"from":{"urlPath":"/notes/emacs-icon-m","entities":[]},"kind":{"urlPath":"/notes/emacs-icon-m","entities":[]}}}}</script></div>
  </body>
</html>
