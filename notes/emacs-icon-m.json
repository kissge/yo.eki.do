{"from":"wordpress","title":"Emacs: ファイル名補完で「Icon^M」を無視する","date":"2014-12-16T22:21:21.000Z","type":"notes","slug":"emacs-icon-m","html":"<p>Emacsでは<code>find-file</code>などでのファイル名補完で特定の拡張子のファイルを候補に含まないように設定できる．\nたとえば.xlsxファイルをEmacsで開くことは普段はあまりないだろう．</p>\n<!--more-->\n<pre><code class=\"hljs language-lisp\">(<span class=\"hljs-name\">setq</span> completion-ignored-extensions\n      (<span class=\"hljs-name\">append</span> completion-ignored-extensions\n              &#x27;(<span class=\"hljs-string\">&quot;./&quot;</span> <span class=\"hljs-string\">&quot;../&quot;</span> <span class=\"hljs-string\">&quot;.xlsx&quot;</span>)))\n(<span class=\"hljs-name\">defadvice</span> completion-file-name-table (<span class=\"hljs-name\">after</span> ignoring-backups-f-n-completion activate)\n  <span class=\"hljs-string\">&quot;filter out results when the have completion-ignored-extensions&quot;</span>\n  (<span class=\"hljs-name\">let</span> ((<span class=\"hljs-name\">res</span> ad-return-value))\n    (<span class=\"hljs-name\">if</span> (<span class=\"hljs-name\">and</span> (<span class=\"hljs-name\">listp</span> res)\n             (<span class=\"hljs-name\">stringp</span> (<span class=\"hljs-name\">car</span> res))\n          (<span class=\"hljs-name\">cdr</span> res)) <span class=\"hljs-comment\">; length &gt; 1, don&#x27;t ignore sole match</span>\n        (<span class=\"hljs-name\">setq</span> ad-return-value\n              (<span class=\"hljs-name\">completion-pcm--filename-try-filter</span> res)))))\n</code></pre>\n<p>（参考：<a href=\"http://stackoverflow.com/questions/1731634/dont-show-uninteresting-files-in-emacs-completion-window\">autocomplete - Don’t show uninteresting files in Emacs completion window - Stack Overflow</a>，Emacsのバージョンによって微妙にどこかを変えなければいけなかったような気がするけど忘れた）</p>\n<p>で，マッキントッシュというオーエスでは<strong>油断すると</strong>「Icon\\r」（\\rは制御文字のCR, 0x0d）という名前のファイルが勝手に作られることがある（「Icon?」「Icon^M」に見える場合もあるだろう）．\n普段は見えないので気にならないが，<strong>油断すると</strong>，例えばDropboxがヘマをすると見えるようになっていて，CRが含まれているせいで非常に邪魔だ．消したい．</p>\n<p>が，<code>completion-ignored-extensions</code>にそのまま<code>“Icon\\r”</code>とか<code>“Icon\\r”</code>とか書いてもうまくいかない．\n何故ならばEmacsが自動的に<code>\\r</code>を<code>\\n</code>に変換してくれているからである．</p>\n<p>このことは次のようにすると確かめられる．</p>\n<pre><code class=\"hljs language-lisp\">(<span class=\"hljs-name\">car</span> (<span class=\"hljs-name\">file-name-all-completions</span> <span class=\"hljs-string\">&quot;Icon&quot;</span> <span class=\"hljs-string\">&quot;~/Dropbox/&quot;</span>))\n=&gt; <span class=\"hljs-string\">&quot;Icon\n&quot;</span>\n\n(<span class=\"hljs-name\">string=</span> <span class=\"hljs-string\">&quot;Icon\\n&quot;</span> (<span class=\"hljs-name\">car</span> (<span class=\"hljs-name\">file-name-all-completions</span> <span class=\"hljs-string\">&quot;Icon&quot;</span> <span class=\"hljs-string\">&quot;~/Dropbox/&quot;</span>)))\n=&gt; <span class=\"hljs-literal\">t</span>\n</code></pre>\n<p>（注．最後の<code>~/Dropbox/</code>を適当にIconからファイル名が始まるファイルがIcon\\rしかないディレクトリに変える）</p>\n<p>と，いうわけで<code>completion-ignored-extensions</code>には<code>“Icon\\n”</code>を追加すればよい．</p>\n","headline":"Emacsではfind-fileなどでのファイル名補完で特定の拡張子のファイルを候補に含まないように設定できる．たとえば.xlsxファイルをEmacsで開くことは普段はあまりないだろう．(setq c"}