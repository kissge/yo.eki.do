<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{from:"wordpress",title:"Emacs: re-builder + foreign-regexp.elでたのしい正規表現",date:"2014-12-19T23:30:53.000Z",tags:["advent"],slug:"foreign-regexp-el",html:"\u003Cp\u003Eこの記事は\u003Ca href=\"http:\u002F\u002Fqiita.com\u002Fadvent-calendar\u002F2014\u002Femacs\"\u003EEmacs Advent Calendar 2014\u003C\u002Fa\u003Eの第20日目の記事として書かれました．\n第19日目はkawabata@githubさんによる「Emacs Lispの汎変数（とその他）」でした．\n第21日目はsanryuuさんによる自作ツールの紹介の予定です．\u003C\u002Fp\u003E\n\u003C!--more--\u003E\n\u003Ch3\u003Eイントロダクション\u003C\u002Fh3\u003E\n\u003Cp\u003Eこんばんは．Emacsのお話をします．わたし自身あまりEmacsのさまざまな機能を使いこなせていないのでそういう読者を想定して書きます．\u003C\u002Fp\u003E\n\u003Cp\u003EEmacsに限らずエディタで何らかのファイルを編集していると，たいていの場合正規表現による検索や置換が欲しくなります．\nそしてEmacsには\u003Ccode\u003Ere-builder\u003C\u002Fcode\u003Eという素晴らしい機能があります．\u003C\u002Fp\u003E\n\u003Cimg src=\"\u002Fimages\u002Fuploads\u002F2014\u002F12\u002FScreen-Shot-2014-12-19-at-9.44.09-PM.png\" width=\"582\" height=\"533\" class=\"alignnone size-full wp-image-184\" data-wp-pid=\"184\" \u002F\u003E\n\u003Cp\u003Eこれは正規表現クエリを書きながら，リアルタイムでそれにマッチする部分を確認出来るという便利なツールです．\nしかし，Emacsの正規表現は御存知の通り少し面倒くさいです．というか結構面倒くさいです．\n上のクエリは\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003E&quot;^\\\\s-+&lt;li&gt;\\\\(.*\\\\)&lt;\u002Fli&gt;&quot;\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003Eですが，これだけの長さの中にバックスラッシュが6回も出て来ます．\nもちろんEmacs Lispを書くときにはコード中にEmacsの正規表現を書くはめになるわけですがあまり気の進む作業ではありません（個人の感想です）．\nたいてい一発でうまくいかなくて適当にバックスラッシュを足したり引いたりするはめになります（個人の感想です）．\nここでPerl互換の正規表現が使えたら便利なわけです（若い方は耳慣れないかもしれませんがPerl互換のというのは正規表現につく枕詞です）．\nそんな流れで今日紹介するのがforeign-regexp.elです．\u003C\u002Fp\u003E\n\u003Ch3\u003Eforeign-regexp.elの導入\u003C\u002Fh3\u003E\n\u003Cp\u003Eというわけでforeign-regexp.elを導入してみましょう．\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fk-talo\u002Fforeign-regexp.el\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fk-talo\u002Fforeign-regexp.el\u003C\u002Fa\u003Eからforeign-regexp.elを入手し，パスの通った場所におきます（動かすだけなら他のファイルは無くとも問題ないようです）．\nそして\u003Ccode\u003E.emacs\u003C\u002Fcode\u003Eに\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003E(require 'foreign-regexp)\n\n(custom-set-variables\n'(foreign-regexp\u002Fregexp-type 'perl) ;; Choose your taste of foreign regexp\n                                    ;; from 'perl, 'ruby or 'javascript.\n'(reb-re-syntax 'foreign-regexp))   ;; Tell re-builder to use foreign regex.\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003Eと追加します．このコードで，foreign-regexp.elで使う正規表現をPerl, Ruby, JavaScript (node.js)から選んで指定し，re-builderで用いる正規表現も変更しています．\n\u003Ccode\u003Eautoload\u003C\u002Fcode\u003Eで書きたい場合は\u003Ccode\u003Ere-builder\u003C\u002Fcode\u003Eか\u003Ccode\u003Eforeign-regexp\u002Fre-builder\u002Fquery-replace-on-target-buffer\u003C\u002Fcode\u003Eに張ればいいでしょう（私はそうしています）．\u003C\u002Fp\u003E\n\u003Cp\u003Eこれだけです．簡単ですね．\u003C\u002Fp\u003E\n\u003Ch3\u003Eつかってみる\u003C\u002Fh3\u003E\n\u003Cp\u003Eあとはそんなに覚えるべきキーバインドも多くはないのですが……一応ひと通り使ってみましょう．\nまず\u003Ckbd\u003EM-s M-l\u003C\u002Fkbd\u003Eで\u003Ccode\u003Ere-builder\u003C\u002Fcode\u003Eを呼び出します．キャンセルして終了するときは\u003Ckbd\u003EC-c C-q\u003C\u002Fkbd\u003Eです．\nそして\u003Ccode\u003E\u003Cem\u003ERE-Builder\u003C\u002Fem\u003E\u003C\u002Fcode\u003Eバッファで置換前にマッチする正規表現を入力します．\u003C\u002Fp\u003E\n\u003Cimg src=\"\u002Fimages\u002Fuploads\u002F2014\u002F12\u002Fregex-fig-02.gif\" width=\"555\" height=\"525\" class=\"alignnone size-full wp-image-192\" data-wp-pid=\"192\" \u002F\u003E\n\u003Cp\u003E完成したらこのままこれを置換クエリに持って行きましょう．\nこのバッファがアクティブなまま\u003Ccode\u003Eforeign-regexp\u002Fre-builder\u002Fquery-replace-on-target-buffer\u003C\u002Fcode\u003Eを呼び出すと置換クエリにそのまま渡せます．\nキーバインドは\u003Ckbd\u003EM-s M-%\u003C\u002Fkbd\u003Eです．\u003C\u002Fp\u003E\n\u003Cimg src=\"\u002Fimages\u002Fuploads\u002F2014\u002F12\u002Fregex-fig-03.gif\" width=\"555\" height=\"525\" class=\"alignnone size-full wp-image-194\" data-wp-pid=\"194\" \u002F\u003E\n\u003Cp\u003E今はPerlの正規表現なので\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fvim-jp\u002Fvimdoc-ja\u002Fissues\u002F57#issuecomment-5841203\"\u003E後方参照（前方参照）\u003C\u002Fa\u003Eも\u003Ccode\u003E$1\u003C\u002Fcode\u003Eでしたね．あとは\u003Ckbd\u003Ey\u003C\u002Fkbd\u003Eまたは\u003Ckbd\u003En\u003C\u002Fkbd\u003Eで一つ一つの置換候補を実際に置き換えるか決定します．\n一括で全て置き換える場合は\u003Ckbd\u003E!\u003C\u002Fkbd\u003Eです．\u003C\u002Fp\u003E\n\u003Cimg src=\"\u002Fimages\u002Fuploads\u002F2014\u002F12\u002Fregex-fig-04.gif\" width=\"555\" height=\"525\" class=\"alignnone size-full wp-image-195\" data-wp-pid=\"195\" \u002F\u003E\n\u003Cp\u003E簡単でしたね．\n嘆くらくはEmacs 24.4でforeign-regexp.elを使おうとすると\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003EWrong type argument: commandp, ad-Orig-foreign-regexp\u002Fquery-replace\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003Eと怒られて使えないことくらいでしょうか．ちょっと対処できるか頑張ってみましたが敗退してEmacs 24.3を使うことで対処しています．かなしい．\u003C\u002Fp\u003E\n\u003Cp\u003Eとはいえ今のは単純な例だったのでmultiple-cursors.elとか使えよ！とかそういう気もしますが，実際正規表現置換は使うので入れておくといざというときに便利です．\nあとはvisual-regexp.elとかpcre2el.elとかも面白そうですよね．\u003C\u002Fp\u003E\n\u003Cp\u003E何かあればコメント欄にくださいますと嬉しいです．\nそれでは．\u003C\u002Fp\u003E\n",headline:"この記事は\u003Ca href=\"http:\u002F\u002Fqiita.com\u002Fadvent-calendar\u002F2014\u002Femacs\"\u003EEmacs Advent Calendar 2014\u003C\u002Fa\u003Eの第20日目の記事とし"},historyURL:"https:\u002F\u002Fgithub.com\u002Fkissge\u002Fyo.eki.do\u002Fcommits\u002Fmaster\u002Fnotes\u002Fforeign-regexp-el.md"}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.f2dd095d.js"}catch(e){main="/client/legacy/client.a96fd353.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <link href=client/client-9e2cfc0b.css rel=stylesheet><link href=client/[slug]-cf2c2a67.css rel=stylesheet> <title>Emacs: re-builder + foreign-regexp.elでたのしい正規表現 - 2014-12-19 | 葉月夜堂</title><script async data-svelte=svelte-a2kvt3 src="https://www.googletagmanager.com/gtag/js?id=UA-45102742-1"></script><meta content=article data-svelte=svelte-14mnzgr property=og:type><meta content="Emacs: re-builder + foreign-regexp.elでたのしい正規表現 - 2014-12-19 | 葉月夜堂" data-svelte=svelte-14mnzgr property=og:title><meta content='この記事は<a href="http://qiita.com/advent-calendar/2014/emacs">Emacs Advent Calendar 2014</a>の第20日目の記事とし' data-svelte=svelte-14mnzgr property=og:description><meta content=葉月夜堂 data-svelte=svelte-14mnzgr property=og:site_name><meta content=https://yo.eki.do/images/default.png data-svelte=svelte-14mnzgr property=og:image> <link href=/client/client.f2dd095d.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-9e2cfc0b.css rel=preload as=style><link href=/client/[slug].ee68746d.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/[slug]-cf2c2a67.css rel=preload as=style></head> <body> <div id=sapper> <nav class=svelte-1vowuxu><ul class=svelte-1vowuxu><li class=svelte-1vowuxu><a href=. class=svelte-1vowuxu rel=prefetch>articles</a></li> <li class=svelte-1vowuxu><a href=about class=svelte-1vowuxu rel=prefetch>about</a></ul> </nav> <main class=svelte-gph4rb> <header class=svelte-1xsha26><div class="svelte-1xsha26 img-header" style=""></div> <h1 class=svelte-1xsha26>Emacs: re-builder + foreign-regexp.elでたのしい正規表現</h1> <time class=svelte-1xsha26>2014-12-20T08:30:53+09:00</time> <div class=tags><div class="svelte-1xsha26 tag">#advent</div></div> <p class="svelte-1xsha26 history"><a href=https://github.com/kissge/yo.eki.do/commits/master/notes/foreign-regexp-el.md>更新履歴</a></header> <div class="svelte-1xsha26 callout">この記事は以前別のところにあったものを移してきたものです。完璧に移植できておらず、表示が崩れているかもしれません。 </div> <div class="svelte-1xsha26 content"><p>この記事は<a href=http://qiita.com/advent-calendar/2014/emacs>Emacs Advent Calendar 2014</a>の第20日目の記事として書かれました． 第19日目はkawabata@githubさんによる「Emacs Lispの汎変数（とその他）」でした． 第21日目はsanryuuさんによる自作ツールの紹介の予定です．</p> <h3>イントロダクション</h3> <p>こんばんは．Emacsのお話をします．わたし自身あまりEmacsのさまざまな機能を使いこなせていないのでそういう読者を想定して書きます．</p> <p>Emacsに限らずエディタで何らかのファイルを編集していると，たいていの場合正規表現による検索や置換が欲しくなります． そしてEmacsには<code>re-builder</code>という素晴らしい機能があります．</p> <img class="alignnone size-full wp-image-184" data-wp-pid=184 height=533 src=/images/uploads/2014/12/Screen-Shot-2014-12-19-at-9.44.09-PM.png width=582> <p>これは正規表現クエリを書きながら，リアルタイムでそれにマッチする部分を確認出来るという便利なツールです． しかし，Emacsの正規表現は御存知の通り少し面倒くさいです．というか結構面倒くさいです． 上のクエリは</p> <pre><code>"^\\s-+&lt;li>\\(.*\\)&lt;/li>"
</code></pre> <p>ですが，これだけの長さの中にバックスラッシュが6回も出て来ます． もちろんEmacs Lispを書くときにはコード中にEmacsの正規表現を書くはめになるわけですがあまり気の進む作業ではありません（個人の感想です）． たいてい一発でうまくいかなくて適当にバックスラッシュを足したり引いたりするはめになります（個人の感想です）． ここでPerl互換の正規表現が使えたら便利なわけです（若い方は耳慣れないかもしれませんがPerl互換のというのは正規表現につく枕詞です）． そんな流れで今日紹介するのがforeign-regexp.elです．</p> <h3>foreign-regexp.elの導入</h3> <p>というわけでforeign-regexp.elを導入してみましょう． <a href=https://github.com/k-talo/foreign-regexp.el>https://github.com/k-talo/foreign-regexp.el</a>からforeign-regexp.elを入手し，パスの通った場所におきます（動かすだけなら他のファイルは無くとも問題ないようです）． そして<code>.emacs</code>に</p> <pre><code>(require 'foreign-regexp)

(custom-set-variables
'(foreign-regexp/regexp-type 'perl) ;; Choose your taste of foreign regexp
                                    ;; from 'perl, 'ruby or 'javascript.
'(reb-re-syntax 'foreign-regexp))   ;; Tell re-builder to use foreign regex.
</code></pre> <p>と追加します．このコードで，foreign-regexp.elで使う正規表現をPerl, Ruby, JavaScript (node.js)から選んで指定し，re-builderで用いる正規表現も変更しています． <code>autoload</code>で書きたい場合は<code>re-builder</code>か<code>foreign-regexp/re-builder/query-replace-on-target-buffer</code>に張ればいいでしょう（私はそうしています）．</p> <p>これだけです．簡単ですね．</p> <h3>つかってみる</h3> <p>あとはそんなに覚えるべきキーバインドも多くはないのですが……一応ひと通り使ってみましょう． まず<kbd>M-s M-l</kbd>で<code>re-builder</code>を呼び出します．キャンセルして終了するときは<kbd>C-c C-q</kbd>です． そして<code><em>RE-Builder</em></code>バッファで置換前にマッチする正規表現を入力します．</p> <img class="alignnone size-full wp-image-192" data-wp-pid=192 height=525 src=/images/uploads/2014/12/regex-fig-02.gif width=555> <p>完成したらこのままこれを置換クエリに持って行きましょう． このバッファがアクティブなまま<code>foreign-regexp/re-builder/query-replace-on-target-buffer</code>を呼び出すと置換クエリにそのまま渡せます． キーバインドは<kbd>M-s M-%</kbd>です．</p> <img class="alignnone size-full wp-image-194" data-wp-pid=194 height=525 src=/images/uploads/2014/12/regex-fig-03.gif width=555> <p>今はPerlの正規表現なので<a href=https://github.com/vim-jp/vimdoc-ja/issues/57#issuecomment-5841203>後方参照（前方参照）</a>も<code>$1</code>でしたね．あとは<kbd>y</kbd>または<kbd>n</kbd>で一つ一つの置換候補を実際に置き換えるか決定します． 一括で全て置き換える場合は<kbd>!</kbd>です．</p> <img class="alignnone size-full wp-image-195" data-wp-pid=195 height=525 src=/images/uploads/2014/12/regex-fig-04.gif width=555> <p>簡単でしたね． 嘆くらくはEmacs 24.4でforeign-regexp.elを使おうとすると</p> <pre><code>Wrong type argument: commandp, ad-Orig-foreign-regexp/query-replace
</code></pre> <p>と怒られて使えないことくらいでしょうか．ちょっと対処できるか頑張ってみましたが敗退してEmacs 24.3を使うことで対処しています．かなしい．</p> <p>とはいえ今のは単純な例だったのでmultiple-cursors.elとか使えよ！とかそういう気もしますが，実際正規表現置換は使うので入れておくといざというときに便利です． あとはvisual-regexp.elとかpcre2el.elとかも面白そうですよね．</p> <p>何かあればコメント欄にくださいますと嬉しいです． それでは．</p> </div> </main></div> 