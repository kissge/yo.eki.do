{"type":"data","nodes":[null,{"type":"data","data":[{"entity":1},{"name":2,"nameSegmented":3,"kind":8,"urlPath":9,"historyURL":10,"lastModified":11,"attributes":12,"tags":15,"body":16,"headline":17,"links":18,"isEmpty":25},"jQueryのmapは勝手にflattenする",[4,5,6,7],"jQueryの","mapは","勝手に","flattenする","note","/notes/jquery-map-flatten","https://github.com/kissge/yo.eki.do/commits/master/notes/jquery-map-flatten.md",["Date","2022-04-17T12:08:43.000Z"],{"from":13,"title":2,"date":14},"wordpress",["Date","2016-12-27T21:08:02.000Z"],[],"\u003C!--more-->\n\n\u003Cp>jQueryの \u003Ccode>map\u003C/code> は勝手に中身をflattenする。つまり、\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-html\">\u003Cspan class=\"hljs-tag\">&lt;\u003Cspan class=\"hljs-name\">ul\u003C/span>&gt;\u003C/span>\n    \u003Cspan class=\"hljs-tag\">&lt;\u003Cspan class=\"hljs-name\">li\u003C/span>&gt;\u003C/span>a\u003Cspan class=\"hljs-tag\">&lt;/\u003Cspan class=\"hljs-name\">li\u003C/span>&gt;\u003C/span>\n    \u003Cspan class=\"hljs-tag\">&lt;\u003Cspan class=\"hljs-name\">li\u003C/span>&gt;\u003C/span>b\u003Cspan class=\"hljs-tag\">&lt;/\u003Cspan class=\"hljs-name\">li\u003C/span>&gt;\u003C/span>\n\u003Cspan class=\"hljs-tag\">&lt;/\u003Cspan class=\"hljs-name\">ul\u003C/span>&gt;\u003C/span>\n\u003Cspan class=\"hljs-tag\">&lt;\u003Cspan class=\"hljs-name\">ul\u003C/span>&gt;\u003C/span>\n    \u003Cspan class=\"hljs-tag\">&lt;\u003Cspan class=\"hljs-name\">li\u003C/span>&gt;\u003C/span>a\u003Cspan class=\"hljs-tag\">&lt;/\u003Cspan class=\"hljs-name\">li\u003C/span>&gt;\u003C/span>\n    \u003Cspan class=\"hljs-tag\">&lt;\u003Cspan class=\"hljs-name\">li\u003C/span>&gt;\u003C/span>b\u003Cspan class=\"hljs-tag\">&lt;/\u003Cspan class=\"hljs-name\">li\u003C/span>&gt;\u003C/span>\n    \u003Cspan class=\"hljs-tag\">&lt;\u003Cspan class=\"hljs-name\">li\u003C/span>&gt;\u003C/span>c\u003Cspan class=\"hljs-tag\">&lt;/\u003Cspan class=\"hljs-name\">li\u003C/span>&gt;\u003C/span>\n\u003Cspan class=\"hljs-tag\">&lt;/\u003Cspan class=\"hljs-name\">ul\u003C/span>&gt;\u003C/span>\n\u003C/code>\u003C/pre>\n\u003Cp>というような構造があったときに\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-js\">$(\u003Cspan class=\"hljs-string\">&#x27;ul&#x27;\u003C/span>).\u003Cspan class=\"hljs-title function_\">map\u003C/span>(\u003Cspan class=\"hljs-function\">(\u003Cspan class=\"hljs-params\">index, element\u003C/span>) =&gt;\u003C/span> $(element).\u003Cspan class=\"hljs-title function_\">find\u003C/span>(\u003Cspan class=\"hljs-string\">&#x27;li&#x27;\u003C/span>).\u003Cspan class=\"hljs-title function_\">map\u003C/span>(\u003Cspan class=\"hljs-function\">(\u003Cspan class=\"hljs-params\">index, element\u003C/span>) =&gt;\u003C/span> $(element).\u003Cspan class=\"hljs-title function_\">text\u003C/span>()).\u003Cspan class=\"hljs-title function_\">toArray\u003C/span>())\n==&gt; [\u003Cspan class=\"hljs-string\">&quot;a&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;b&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;a&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;b&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;c&quot;\u003C/span>] \u003Cspan class=\"hljs-comment\">// not [[&quot;a&quot;, &quot;b&quot;], [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]]\u003C/span>\n\u003C/code>\u003C/pre>\n\u003Cp>と勝手に入れ子になった配列がひとつの配列に変換されてしまう。一応これはバグではなく仕様のようだ（\u003Ca href=\"https://bugs.jquery.com/ticket/10541\">参考\u003C/a>）。どう対応するのがいいのかよく分からないが……dirty hackとしては戻り値をさらに配列でラップすると一応欲しいものは得られる。\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-js\">$(\u003Cspan class=\"hljs-string\">&#x27;ul&#x27;\u003C/span>).\u003Cspan class=\"hljs-title function_\">map\u003C/span>(\u003Cspan class=\"hljs-function\">(\u003Cspan class=\"hljs-params\">index, element\u003C/span>) =&gt;\u003C/span> [$(element).\u003Cspan class=\"hljs-title function_\">find\u003C/span>(\u003Cspan class=\"hljs-string\">&#x27;li&#x27;\u003C/span>).\u003Cspan class=\"hljs-title function_\">map\u003C/span>(\u003Cspan class=\"hljs-function\">(\u003Cspan class=\"hljs-params\">index, element\u003C/span>) =&gt;\u003C/span> $(element).\u003Cspan class=\"hljs-title function_\">text\u003C/span>()).\u003Cspan class=\"hljs-title function_\">toArray\u003C/span>()])\n==&gt; [[\u003Cspan class=\"hljs-string\">&quot;a&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;b&quot;\u003C/span>], [\u003Cspan class=\"hljs-string\">&quot;a&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;b&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;c&quot;\u003C/span>]]\n\u003C/code>\u003C/pre>\n\u003Cp>うーん、やだなあ。同じ挙動は \u003Ccode>jQuery.map\u003C/code> でも見られる。ただし引数の順番が逆だけど。\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-js\">$.\u003Cspan class=\"hljs-title function_\">map\u003C/span>($(\u003Cspan class=\"hljs-string\">&#x27;ul&#x27;\u003C/span>), \u003Cspan class=\"hljs-function\">(\u003Cspan class=\"hljs-params\">element, index\u003C/span>) =&gt;\u003C/span> $.\u003Cspan class=\"hljs-title function_\">map\u003C/span>($(element).\u003Cspan class=\"hljs-title function_\">find\u003C/span>(\u003Cspan class=\"hljs-string\">&#x27;li&#x27;\u003C/span>), \u003Cspan class=\"hljs-function\">(\u003Cspan class=\"hljs-params\">element, index\u003C/span>) =&gt;\u003C/span> $(element).\u003Cspan class=\"hljs-title function_\">text\u003C/span>()))\n==&gt; [\u003Cspan class=\"hljs-string\">&quot;a&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;b&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;a&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;b&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;c&quot;\u003C/span>] \u003Cspan class=\"hljs-comment\">// not [[&quot;a&quot;, &quot;b&quot;], [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]]\u003C/span>\n\n$.\u003Cspan class=\"hljs-title function_\">map\u003C/span>($(\u003Cspan class=\"hljs-string\">&#x27;ul&#x27;\u003C/span>), \u003Cspan class=\"hljs-function\">(\u003Cspan class=\"hljs-params\">element, index\u003C/span>) =&gt;\u003C/span> [$.\u003Cspan class=\"hljs-title function_\">map\u003C/span>($(element).\u003Cspan class=\"hljs-title function_\">find\u003C/span>(\u003Cspan class=\"hljs-string\">&#x27;li&#x27;\u003C/span>), \u003Cspan class=\"hljs-function\">(\u003Cspan class=\"hljs-params\">element, index\u003C/span>) =&gt;\u003C/span> $(element).\u003Cspan class=\"hljs-title function_\">text\u003C/span>())])\n==&gt; [[\u003Cspan class=\"hljs-string\">&quot;a&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;b&quot;\u003C/span>], [\u003Cspan class=\"hljs-string\">&quot;a&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;b&quot;\u003C/span>, \u003Cspan class=\"hljs-string\">&quot;c&quot;\u003C/span>]]\n\u003C/code>\u003C/pre>\n\u003Cp>やめてほしい。\u003C/p>\n","jQueryの map は勝手に中身をflattenする。つまり、&lt;ul&gt;    &lt;li&gt;a&lt;/li&gt;    &lt;li&gt;b&lt;/li&gt;&lt;/ul&gt;&lt;ul&gt;    &lt;li&gt;a&lt;/li&gt;    &lt;li&gt;b&lt;/li&gt;    &lt;li&gt;c&lt;/li&gt;&lt;/ul&gt;というような構造があったときに$(&#x27;ul&#x27;).map((index, element) =&gt; $(element).find(&#x27;li&#x27;).map((index, element) =&gt; $(element).text()).toArray())==&gt; [&quot;a&quot;, &quot;b&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;] // not [[&quot;a&quot;, &quot;b&quot;], [&quot;a&quot;, &quot;b&quot;, &quot",{"to":19,"from":21,"kind":23},{"urlPath":9,"entities":20},[],{"urlPath":9,"entities":22},[],{"urlPath":9,"entities":24},[],false],"uses":{"url":1}}]}
