{"type":"data","nodes":[null,{"type":"data","data":[{"entity":1},{"name":2,"nameSegmented":3,"kind":6,"urlPath":7,"historyURL":8,"lastModified":9,"attributes":10,"tags":15,"body":19,"headline":20,"links":21,"isEmpty":49},"Emacs: まだターミナルで消耗してるの？",[4,5],"Emacs: まだターミナルで","消耗してるの？","note","/notes/tramp-mode","https://github.com/kissge/yo.eki.do/commits/master/notes/tramp-mode.md",["Date","2022-06-11T07:33:39.000Z"],{"from":11,"title":2,"date":12,"tags":13},"wordpress",["Date","2015-12-04T23:00:02.000Z"],[14],"アドベントカレンダー",[16],{"name":14,"kind":17,"urlPath":18},"tag","/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC","\u003Cp>この記事は\u003Ca href=\"http://qiita.com/advent-calendar/2015/emacs\">Emacs Advent Calendar 2015\u003C/a>の第5日目の記事として書かれました。第4日目は\u003Ca href=\"http://qiita.com/niku\">niku\u003C/a>さんによる記事の予定です。「org-babelについて書くかも」とのこと。第6日目は\u003Ca href=\"http://qiita.com/takaxp\">takaxp\u003C/a>さんによる記事の予定です。「何も書かずに2015年を終えられると思うほど堕落してはおらんっ」とのこと。\u003C/p>\n\u003C!--more-->\n\n\u003Ch2 id=\"ずいぶんとダサい開発をしているのね\">ずいぶんとダサい開発をしているのね\u003C/h2>\n\u003Cp>所属柄私の周りには少なくないEmacsユーザがいるのに、だれも \u003Ccode>tramp-mode\u003C/code> のことを知らないようでここ数ヶ月で2、3回同じことを説明するはめになったのでついでにここにも書くことにします。初心者に説明する意図での記述なのでコアなユーザの方には物足りないものかもしれません。\u003C/p>\n\u003Cp>さてみなさん普段GUIでEmacs使ってますか？\n使ってるのにときどきCUIを使わざるを得ないという状況に陥りますか？\nだいたいそういうケースは次のどちらかのパターンなのではないでしょうか。\u003C/p>\n\u003Col>\n\u003Cli>rootとしてファイルを開きたい（\u003Ccode>sudo\u003C/code> したい）とき\u003C/li>\n\u003Cli>ssh先のサーバ上でファイルを編集したいとき\u003C/li>\n\u003C/ol>\n\u003Cp>まあどちらもままあることです。2. に至っては「手元（ローカル）のEmacsとで設定ファイルが共有されていないから不便／共有するのが面倒」なんてことになってませんか？よくないやつですね。こういった問題を全て解決する簡単な方法のひとつが \u003Ccode>tramp-mode\u003C/code> です。\u003C/p>\n\u003Ch2 id=\"tramp-mode-で-sudo-してみる\">\u003Ccode>tramp-mode\u003C/code> で \u003Ccode>sudo\u003C/code> してみる\u003C/h2>\n\u003Cp>というわけで幾つかの使用例を見てみましょう。\u003Ccode>tramp-mode\u003C/code> はいま普通にEmacsを使っているユーザの大半の環境では最初から入っているかと思いますが、22.1より古いバージョンを使っている方が万が一いればEmacsをバージョンアップしてください。\u003C/p>\n\u003Cp>たとえば \u003Ccode>/etc/httpd/conf/httpd.conf\u003C/code> を開くとき、普通に開くとread-onlyとなり\u003C/p>\n\u003Cpre>\u003Ccode>Note: file is write protected\n\u003C/code>\u003C/pre>\n\u003Cp>と怒られるかと思います。これをrootとして開くには次のように\u003C/p>\n\u003Cpre>\u003Ccode>C-x C-f /sudo::/etc/httpd/conf/httpd.conf\n\u003C/code>\u003C/pre>\n\u003Cp>と \u003Ccode>find-file\u003C/code> に渡すパスの前に \u003Ccode>/sudo::\u003C/code> を追加するだけです。\u003Ccode>/su::\u003C/code> なら更に短縮できますね（挙動の違いは見てお分かりの通りです）。\u003C/p>\n\u003Ch2 id=\"tramp-mode-でssh先のサーバ上のファイルを編集してみる\">\u003Ccode>tramp-mode\u003C/code> でssh先のサーバ上のファイルを編集してみる\u003C/h2>\n\u003Cp>同じように、sshで接続できる外部サーバ上のファイルを開くには\u003C/p>\n\u003Cpre>\u003Ccode>C-x C-f /user@example.com:path/to/file\n\u003C/code>\u003C/pre>\n\u003Cp>です。ユーザ名とホスト名のあとは \u003Ccode>/\u003C/code> からはじめてフルパスを書くか、あるいは \u003Ccode>$HOME\u003C/code> からの相対パスを書くことが出来ます。実はこの記法は接続メソッドが自動でデフォルトで補われているもので、次の略記です。\u003C/p>\n\u003Cpre>\u003Ccode>/scp:user@example.com:path/to/file\n\u003C/code>\u003C/pre>\n\u003Cp>この \u003Ccode>scp\u003C/code> はいくつかある接続メソッドの一つです。メソッドを省略した場合は \u003Ccode>tramp-default-method\u003C/code> という変数の内容を見て決定されます。Emacs 24.3くらいまではこの変数のデフォルト値は \u003Ccode>scpc\u003C/code> だったような気がしますが廃止されました。\u003Ccode>scp\u003C/code> では基本的にホストとの接続はsshで行われ、ファイルの転送はscpで行われます。頻繁にファイルを開いたり閉じたりする場合にはscpのオーバヘッドが効いて、すべてsshで行う \u003Ccode>ssh\u003C/code> というメソッドのほうが速い場合もあります。\u003C/p>\n\u003Cp>ちなみに \u003Ccode>shell\u003C/code> も開けるし \u003Ccode>compile\u003C/code> だって出来ます。便利〜\u003C/p>\n\u003Ch2 id=\"ssh先からsshした先のファイルを編集する\">ssh先からsshした先のファイルを編集する\u003C/h2>\n\u003Cp>何だか\u003Ca href=\"/mono/%E6%97%A5%E6%9C%AC%E8%AA%9E\" class=\"monolog-link\"  title=\"日本語\">日本語\u003C/a>が怪しいですが、いわゆる踏み台サーバみたいなものが中間にある状況です。これもままあるかとおもいます。もっともよい解決策はsshのconfigに \u003Ccode>ProxyCommand\u003C/code> を設定することでこのホップを自動で行わせることでしょう。たとえば \u003Ccode>example1.com\u003C/code> に繋ぐために \u003Ccode>example2.com\u003C/code> に一旦繋ぐ必要がある場合には、sshのconfig（たとえば \u003Ccode>~/.ssh/config\u003C/code> ）に\u003C/p>\n\u003Cpre>\u003Ccode>Host example1\n    HostName example1.com\n    ProxyCommand ssh example2 -W %h:%p 2&gt; /dev/null\nHost example2\n    HostName example2.com\n\u003C/code>\u003C/pre>\n\u003Cp>などと書くことでターミナルから\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-sh\">$ ssh example1\n\u003C/code>\u003C/pre>\n\u003Cp>だけで一発で目的のホストに繋ぐことが出来ます。この設定をしているときにはEmacsで\u003C/p>\n\u003Cpre>\u003Ccode>C-x C-f /example1:path/to/file\n\u003C/code>\u003C/pre>\n\u003Cp>とするとこのホップを裏で自動で行ってもらうことが出来ます。\u003C/p>\n\u003Cp>もう一つの方法は \u003Ccode>tramp-mode\u003C/code> で明示的にホップさせることです。おそらくいま使われているような最近のバージョン (24.3以降) ですと\u003C/p>\n\u003Cpre>\u003Ccode>C-x C-f /ssh:example2.com|ssh:example1.com:path/to/file\n\u003C/code>\u003C/pre>\n\u003Cp>で同じことが出来るかと思います。\u003C/p>\n\u003Ch2 id=\"ssh先でsudoする\">ssh先でsudoする\u003C/h2>\n\u003Cp>ここまで読むともう次に何をするかはおわかりでしょう。実際ssh先でroot権限でファイルを読むこともよくありますよね。\u003C/p>\n\u003Cpre>\u003Ccode>C-x C-f /ssh:user@example.com|sudo:example.com:/etc/httpd/conf/httpd.conf\n\u003C/code>\u003C/pre>\n\u003Ch2 id=\"陥りがちなトラップ\">陥りがちなトラップ\u003C/h2>\n\u003Cp>いくつか注意点のようなもの。\u003C/p>\n\u003Cp>ホップして踏み台越しの接続をするときに \u003Ccode>/ssh:foo|sudo:foo:/etc/...\u003C/code> のように \u003Ccode>ssh\u003C/code> を省略することは出来ません。上述のようにこの場合デフォルトの \u003Ccode>scp\u003C/code> が使用されますが、このメソッドはホップに対応していません。また、\u003Ccode>sudo::\u003C/code> とホストを省略する記法もここでは使えません。\u003C/p>\n\u003Cp>また、 \u003Ccode>tramp-mode\u003C/code> で繋ぐ先のホストのログインシェルがzshの場合、接続がうまくいかない場合があります。よく見受けられる対処法（私も使っています）は、 \u003Ccode>.zshrc\u003C/code> の1行目にEmacsからの接続を識別する場合分けを追加することのようです。\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-sh\">[[ \u003Cspan class=\"hljs-variable\">$TERM\u003C/span> == \u003Cspan class=\"hljs-string\">&quot;dumb&quot;\u003C/span> ]] &amp;&amp; \u003Cspan class=\"hljs-built_in\">unsetopt\u003C/span> \u003Cspan class=\"hljs-built_in\">zle\u003C/span> &amp;&amp; PS1=\u003Cspan class=\"hljs-string\">&#x27;$ &#x27;\u003C/span> &amp;&amp; \u003Cspan class=\"hljs-built_in\">return\u003C/span>\n\u003C/code>\u003C/pre>\n\u003Cp>もう一点上級者向けっぽいことを書くと、システムグローバルな設定のままControlMasterを使うようにカスタマイズする場合、Emacsで最初にshared connectionを開いてからターミナルなどでsshセッションを開き、Emacsを終了するとターミナルの方も同時に落ちる、というようなことになる場合があります。このへんは好き好きというか、一般にどうするのがよいのか不明です。カスタマイズしなければ関係ないですが。\u003C/p>\n\u003Ch2 id=\"結論：便利なので使いましょう\">結論：便利なので使いましょう\u003C/h2>\n\u003Cp>というわけで画像もなくずらずらと使い方を書いてみました。本当にstraightforwardなのでとくに説明することもないですね。インストールもないし。ご存知なかった方はぜひぜひ使い倒してみてください。ではでは。\u003C/p>\n\u003Ch2 id=\"ところで関係ないけど\">ところで関係ないけど\u003C/h2>\n\u003Cp>Emacs 24.5で \u003Ccode>;;;###tramp-autoload\u003C/code> にバグがあるような気がするのですがHEADで再現しないのでどこかに報告したほうがいいのかどうなのか分からずにいる。具体的には\u003C/p>\n\u003Cx-script src=\"https://gist.github.com/kissge/a9f1c59959181856280f.js\">\u003C/x-script>\u003Cp>を使って\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-sh\">emacs -q -l init.el\n\u003C/code>\u003C/pre>\n\u003Cp>などとして起動した後\u003C/p>\n\u003Cpre>\u003Ccode>C-h v tramp-verbose\n\u003C/code>\u003C/pre>\n\u003Cp>とすると設定通り変数が変更されているのが確認できるが\u003C/p>\n\u003Cpre>\u003Ccode>C-h v tramp-use-ssh-controlmaster-options\n\u003C/code>\u003C/pre>\n\u003Cp>とするとデフォルトの設定で上書きされている。\u003Ccode>tramp-use-ssh-controlmaster-options\u003C/code> 以外にも \u003Ccode>;;;###tramp-autoload\u003C/code> が指定されている変数で同様の現象が確認できる。\u003C/p>\n","この記事はEmacs Advent Calendar 2015の第5日目の記事として書かれました。第4日目はnikuさんによる記事の予定です。「org-babelについて書くかも」とのこと。第6日目はtakaxpさんによる記事の予定です。「何も書かずに2015年を終えられると思うほど堕落してはおらんっ」とのこと。ずいぶんとダサい開発をしているのね所属柄私の周りには少なくないEmacsユーザがいるのに、だれも tramp-mode のことを知らないようでここ数ヶ月で2、3回同じことを説明するはめになったのでついでにここにも書くことにします。初心者に説明する意図での記述なのでコアなユーザの方には物足りないものかもしれません。さてみなさん普段GUIでEmacs使ってますか？使ってるのにときどきCUIを使わざるを得ないという状況に陥りますか？だいたいそういうケースは次のどちらかのパターンなのではないでしょうか。rootとしてファイルを開きたい（sudo したい）ときssh先のサーバ上でファイルを編集したいときまあどちらもままあることです。2. に至っては「手元（ローカル）のEmacsとで設定ファイルが共有されていない",{"to":22,"from":33,"one_hop_日本語":50,"one_hop_アドベントカレンダー":104},{"urlPath":7,"entities":23},[24,30],{"name":25,"nameSegmented":26,"kind":17,"urlPath":27,"tags":28,"isEmpty":29},"日本語",[25],"/mono/%E6%97%A5%E6%9C%AC%E8%AA%9E",[],true,{"name":14,"nameSegmented":31,"kind":17,"urlPath":18,"tags":32,"isEmpty":29},[14],[],{"urlPath":7,"entities":34},[35],{"name":36,"nameSegmented":37,"kind":6,"urlPath":41,"historyURL":42,"lastModified":43,"attributes":44,"tags":47,"isEmpty":49},"Emacs: Windowsでやっていく2017",[38,39,40],"Emacs: Windowsで","やっていく","2017","/notes/emacs-windows-2017","https://github.com/kissge/yo.eki.do/commits/master/notes/emacs-windows-2017.md",["Date","2022-07-02T05:00:46.000Z"],{"from":11,"title":36,"date":45,"tags":46},["Date","2017-12-08T00:00:08.000Z"],[14],[48],{"name":14,"kind":17,"urlPath":18},false,{"urlPath":27,"entities":51},[52,65,77,103],{"name":53,"nameSegmented":54,"kind":57,"urlPath":58,"historyURL":59,"lastModified":60,"attributes":61,"tags":63,"isEmpty":49},"リバーシブルな二字熟語",[55,56],"リバーシブルな","二字熟語","memorandum","/memorandum/%E3%83%AA%E3%83%90%E3%83%BC%E3%82%B7%E3%83%96%E3%83%AB%E3%81%AA%E4%BA%8C%E5%AD%97%E7%86%9F%E8%AA%9E","https://github.com/kissge/yo.eki.do/commits/master/memorandum/リバーシブルな二字熟語.md",["Date","2024-01-28T06:51:56.000Z"],{"tags":62},[25],[64],{"name":25,"kind":17,"urlPath":27},{"name":66,"nameSegmented":67,"kind":6,"urlPath":68,"historyURL":69,"lastModified":70,"attributes":71,"tags":75,"isEmpty":49},"How do Japanese type?",[66],"/notes/how-do-japanese-type","https://github.com/kissge/yo.eki.do/commits/master/notes/how-do-japanese-type.md",["Date","2022-06-11T11:32:30.000Z"],{"title":66,"date":72,"lang":73,"tags":74},["Date","2022-05-29T01:00:00.000Z"],"en",[25],[76],{"name":25,"kind":17,"urlPath":27},{"name":78,"nameSegmented":79,"kind":6,"urlPath":93,"historyURL":94,"lastModified":95,"attributes":96,"tags":100,"isEmpty":49},"ja-JP-u-ca-japaneseって何？ UnicodeのCLDRを読んでみよう（あるいは、JavaScriptで和暦を得る簡単なテクについて）",[80,81,82,83,84,85,86,87,88,89,90,91,92],"ja-JP-u-ca-japaneseって","何？"," Unicodeの","CLDRを","読んで","みよう","（あるいは、","JavaScriptで","和暦を","得る","簡単な","テクに","ついて）","/notes/cldr","https://github.com/kissge/yo.eki.do/commits/master/notes/cldr.md",["Date","2022-06-11T11:32:20.000Z"],{"title":78,"date":97,"tags":98},["Date","2022-02-19T02:41:00.000Z"],[99],"Unicode",[101],{"name":99,"kind":17,"urlPath":102},"/mono/Unicode",{"name":36,"nameSegmented":37,"kind":6,"urlPath":41,"historyURL":42,"lastModified":43,"attributes":44,"tags":47,"isEmpty":49},{"urlPath":18,"entities":105},[106,123,137,153,154],{"name":107,"nameSegmented":108,"kind":6,"urlPath":112,"historyURL":113,"lastModified":114,"attributes":115,"tags":119,"isEmpty":49},"PDFと、出版社と、私",[109,110,111],"PDFと、","出版社と、","私","/notes/pdf-publisher-and-me","https://github.com/kissge/yo.eki.do/commits/master/notes/pdf-publisher-and-me.md",["Date","2022-09-04T05:58:48.000Z"],{"title":107,"date":116,"tags":117},["Date","2021-12-23T05:00:00.000Z"],[14,118],"LegalTech",[120,121],{"name":14,"kind":17,"urlPath":18},{"name":118,"kind":17,"urlPath":122},"/mono/LegalTech",{"name":124,"nameSegmented":125,"kind":6,"urlPath":129,"historyURL":130,"lastModified":131,"attributes":132,"tags":135,"isEmpty":49},"リーガルリサーチシステム「Legalscape」の技術スタック2021",[126,127,128],"リーガルリサーチシステム","「Legalscape」の","技術スタック2021","/notes/legalscape-tech-stack","https://github.com/kissge/yo.eki.do/commits/master/notes/legalscape-tech-stack.md",["Date","2022-06-11T07:33:39.000Z"],{"title":124,"date":133,"tags":134},["Date","2021-12-02T00:00:00.000Z"],[14],[136],{"name":14,"kind":17,"urlPath":18},{"name":138,"nameSegmented":139,"kind":6,"urlPath":145,"historyURL":146,"lastModified":147,"attributes":148,"tags":151,"isEmpty":49},"来年こそは届いてほしいスマートグラス「Vue」",[140,141,142,143,144],"来年こそは","届いて","ほしい","スマートグラス","「Vue」","/notes/crowdfunding-vue","https://github.com/kissge/yo.eki.do/commits/master/notes/crowdfunding-vue.md",["Date","2022-06-11T07:34:19.000Z"],{"from":11,"title":138,"date":149,"tags":150},["Date","2018-12-13T00:17:07.000Z"],[14],[152],{"name":14,"kind":17,"urlPath":18},{"name":36,"nameSegmented":37,"kind":6,"urlPath":41,"historyURL":42,"lastModified":43,"attributes":44,"tags":47,"isEmpty":49},{"name":155,"nameSegmented":156,"kind":6,"urlPath":159,"historyURL":160,"lastModified":161,"attributes":162,"tags":165,"isEmpty":49},"Emacs: re-builder + foreign-regexp.elでたのしい正規表現",[157,158],"Emacs: re-builder + foreign-regexp.elでたのしい","正規表現","/notes/foreign-regexp-el","https://github.com/kissge/yo.eki.do/commits/master/notes/foreign-regexp-el.md",["Date","2022-06-11T07:52:23.000Z"],{"from":11,"title":155,"date":163,"tags":164},["Date","2014-12-19T23:30:53.000Z"],[14],[166],{"name":14,"kind":17,"urlPath":18}],"uses":{"url":1}}]}
