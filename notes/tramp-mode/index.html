<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/images/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/github.min.css" />
    <meta http-equiv="content-security-policy" content=""><title>Emacs: まだターミナルで消耗してるの？ - 2015-12-05 | 葉月夜堂</title><link href="https://twitter.com/p_km" rel="me" data-svelte="svelte-10crdf0">
    <link rel="webmention" href="https://webmention.io/sveltekit-prerender/webmention" data-svelte="svelte-10crdf0">
    <link rel="pingback" href="https://webmention.io/sveltekit-prerender/xmlrpc" data-svelte="svelte-10crdf0"><meta property="og:type" content="article" data-svelte="svelte-6t30ru"><meta property="og:title" content="Emacs: まだターミナルで消耗してるの？ - 2015-12-05 | 葉月夜堂" data-svelte="svelte-6t30ru"><meta property="og:description" content="この記事はEmacs Advent Calendar 2015の第5日目の記事として書かれました。第4日目はnikuさんによる記事の予定です。「org-babelについて書くかも」とのこと。第6日目はtakaxpさんによる記事の予定です。「何も書かずに2015年を終えられると思うほど堕落してはおらんっ」とのこと。ずいぶんとダサい開発をしているのね所属柄私の周りには少なくないEmacsユーザがいるのに、だれも tramp-mode のことを知らないようでここ数ヶ月で2、3回同じことを説明するはめになったのでついでにここにも書くことにします。初心者に説明する意図での記述なのでコアなユーザの方には物足りないものかもしれません。さてみなさん普段GUIでEmacs使ってますか？使ってるのにときどきCUIを使わざるを得ないという状況に陥りますか？だいたいそういうケースは次のどちらかのパターンなのではないでしょうか。rootとしてファイルを開きたい（sudo したい）ときssh先のサーバ上でファイルを編集したいときまあどちらもままあることです。2. に至っては「手元（ローカル）のEmacsとで設定ファイルが共有されていない" data-svelte="svelte-6t30ru"><meta property="og:site_name" content="葉月夜堂" data-svelte="svelte-6t30ru"><meta property="og:image" content="http://sveltekit-prerender/images/favicon.svg" data-svelte="svelte-6t30ru">
	<link rel="stylesheet" href="/_app/immutable/assets/pages/__layout.svelte-f9a44566.css">
	<link rel="stylesheet" href="/_app/immutable/assets/time.svelte_svelte_type_style_lang-61ea3f89.css">
	<link rel="stylesheet" href="/_app/immutable/assets/pages/_...entity_.svelte-d69f21a9.css">
	<link rel="modulepreload" href="/_app/immutable/start-1fea0f3b.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/index-7416df8b.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/singletons-d1fb5791.js">
	<link rel="modulepreload" href="/_app/immutable/pages/__layout.svelte-0c722760.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/time.svelte_svelte_type_style_lang-2ab901cd.js">
	<link rel="modulepreload" href="/_app/immutable/pages/_...entity_.svelte-8f381217.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/tags-06b98af7.js">
  </head>
  <body>
    <div>




<nav><ul><li><a sveltekit:prefetch href="/">葉月夜堂</a>
      </li><li><a sveltekit:prefetch href="/about">about</a>
      </li></ul></nav>



<div class="nav-background svelte-6mvvsp isHeaderInView" style=""></div>

<main><article data-kind="note" class="svelte-6mvvsp"><header class="svelte-6mvvsp"><h1 class="svelte-6mvvsp">Emacs: まだ<wbr>ターミナルで<wbr>消耗してるの？</h1>

      

      <section class="meta svelte-6mvvsp"><p class="svelte-6mvvsp"><time title="6 年半前" class="svelte-5ni4x2">Fri Dec 04 2015 23:00:02 GMT+0000 (Coordinated Universal Time)</time></p>

        <p class="svelte-6mvvsp"><a href="https://github.com/kissge/yo.eki.do/commits/master/notes/tramp-mode.md" title="Sat Jun 11 2022 07:33:39 GMT+0000 (Coordinated Universal Time)" class="svelte-6mvvsp">最終更新：21 日前</a></p></section>

      

      <section class="svelte-6mvvsp"><a sveltekit:prefetch href="/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC" class="tag svelte-k4uca large" data-kind="tag">アドベントカレンダー</a>
  </section>

      <section class="header-image svelte-6mvvsp" style=""></section></header>

    <section class="body svelte-6mvvsp"><!-- HTML_TAG_START --><p>この記事は<a href="http://qiita.com/advent-calendar/2015/emacs">Emacs Advent Calendar 2015</a>の第5日目の記事として書かれました。
第4日目は<a href="http://qiita.com/niku">niku</a>さんによる記事の予定です。「org-babelについて書くかも」とのこと。
第6日目は<a href="http://qiita.com/takaxp">takaxp</a>さんによる記事の予定です。「何も書かずに2015年を終えられると思うほど堕落してはおらんっ」とのこと。</p>
<!--more-->

<h2 id="ずいぶんとダサい開発をしているのね">ずいぶんとダサい開発をしているのね</h2>
<p>所属柄私の周りには少なくないEmacsユーザがいるのに、だれも <code>tramp-mode</code> のことを知らないようでここ数ヶ月で2、3回同じことを説明するはめになったのでついでにここにも書くことにします。
初心者に説明する意図での記述なのでコアなユーザの方には物足りないものかもしれません。</p>
<p>さてみなさん普段GUIでEmacs使ってますか？
使ってるのにときどきCUIを使わざるを得ないという状況に陥りますか？
だいたいそういうケースは次のどちらかのパターンなのではないでしょうか。</p>
<ol>
<li>rootとしてファイルを開きたい（<code>sudo</code> したい）とき</li>
<li>ssh先のサーバ上でファイルを編集したいとき</li>
</ol>
<p>まあどちらもままあることです。2. に至っては「手元（ローカル）のEmacsとで設定ファイルが共有されていないから不便／共有するのが面倒」なんてことになってませんか？よくないやつですね。
こういった問題を全て解決する簡単な方法のひとつが <code>tramp-mode</code> です。</p>
<h2 id="tramp-mode-で-sudo-してみる"><code>tramp-mode</code> で <code>sudo</code> してみる</h2>
<p>というわけで幾つかの使用例を見てみましょう。
<code>tramp-mode</code> はいま普通にEmacsを使っているユーザの大半の環境では最初から入っているかと思いますが、22.1より古いバージョンを使っている方が万が一いればEmacsをバージョンアップしてください。</p>
<p>たとえば <code>/etc/httpd/conf/httpd.conf</code> を開くとき、普通に開くとread-onlyとなり</p>
<pre><code>Note: file is write protected
</code></pre>
<p>と怒られるかと思います。これをrootとして開くには次のように</p>
<pre><code>C-x C-f /sudo::/etc/httpd/conf/httpd.conf
</code></pre>
<p>と <code>find-file</code> に渡すパスの前に <code>/sudo::</code> を追加するだけです。
<code>/su::</code> なら更に短縮できますね（挙動の違いは見てお分かりの通りです）。</p>
<h2 id="tramp-mode-でssh先のサーバ上のファイルを編集してみる"><code>tramp-mode</code> でssh先のサーバ上のファイルを編集してみる</h2>
<p>同じように、sshで接続できる外部サーバ上のファイルを開くには</p>
<pre><code>C-x C-f /user@example.com:path/to/file
</code></pre>
<p>です。ユーザ名とホスト名のあとは <code>/</code> からはじめてフルパスを書くか、あるいは <code>$HOME</code> からの相対パスを書くことが出来ます。
実はこの記法は接続メソッドが自動でデフォルトで補われているもので、次の略記です。</p>
<pre><code>/scp:user@example.com:path/to/file
</code></pre>
<p>この <code>scp</code> はいくつかある接続メソッドの一つです。
メソッドを省略した場合は <code>tramp-default-method</code> という変数の内容を見て決定されます。
Emacs 24.3くらいまではこの変数のデフォルト値は <code>scpc</code> だったような気がしますが廃止されました。
<code>scp</code> では基本的にホストとの接続はsshで行われ、ファイルの転送はscpで行われます。
頻繁にファイルを開いたり閉じたりする場合にはscpのオーバヘッドが効いて、すべてsshで行う <code>ssh</code> というメソッドのほうが速い場合もあります。</p>
<p>ちなみに <code>shell</code> も開けるし <code>compile</code> だって出来ます。便利〜</p>
<h2 id="ssh先からsshした先のファイルを編集する">ssh先からsshした先のファイルを編集する</h2>
<p>何だか<a href="/mono/%E6%97%A5%E6%9C%AC%E8%AA%9E" class="monolog-link" sveltekit:prefetch title="日本語">日本語</a>が怪しいですが、いわゆる踏み台サーバみたいなものが中間にある状況です。これもままあるかとおもいます。
もっともよい解決策はsshのconfigに <code>ProxyCommand</code> を設定することでこのホップを自動で行わせることでしょう。
たとえば <code>example1.com</code> に繋ぐために <code>example2.com</code> に一旦繋ぐ必要がある場合には、sshのconfig（たとえば <code>~/.ssh/config</code> ）に</p>
<pre><code>Host example1
    HostName example1.com
    ProxyCommand ssh example2 -W %h:%p 2&gt; /dev/null
Host example2
    HostName example2.com
</code></pre>
<p>などと書くことでターミナルから</p>
<pre><code class="language-sh">$ ssh example1
</code></pre>
<p>だけで一発で目的のホストに繋ぐことが出来ます。この設定をしているときにはEmacsで</p>
<pre><code>C-x C-f /example1:path/to/file
</code></pre>
<p>とするとこのホップを裏で自動で行ってもらうことが出来ます。</p>
<p>もう一つの方法は <code>tramp-mode</code> で明示的にホップさせることです。
おそらくいま使われているような最近のバージョン (24.3以降) ですと</p>
<pre><code>C-x C-f /ssh:example2.com|ssh:example1.com:path/to/file
</code></pre>
<p>で同じことが出来るかと思います。</p>
<h2 id="ssh先でsudoする">ssh先でsudoする</h2>
<p>ここまで読むともう次に何をするかはおわかりでしょう。実際ssh先でroot権限でファイルを読むこともよくありますよね。</p>
<pre><code>C-x C-f /ssh:user@example.com|sudo:example.com:/etc/httpd/conf/httpd.conf
</code></pre>
<h2 id="陥りがちなトラップ">陥りがちなトラップ</h2>
<p>いくつか注意点のようなもの。</p>
<p>ホップして踏み台越しの接続をするときに <code>/ssh:foo|sudo:foo:/etc/...</code> のように <code>ssh</code> を省略することは出来ません。
上述のようにこの場合デフォルトの <code>scp</code> が使用されますが、このメソッドはホップに対応していません。
また、<code>sudo::</code> とホストを省略する記法もここでは使えません。</p>
<p>また、 <code>tramp-mode</code> で繋ぐ先のホストのログインシェルがzshの場合、接続がうまくいかない場合があります。
よく見受けられる対処法（私も使っています）は、 <code>.zshrc</code> の1行目にEmacsからの接続を識別する場合分けを追加することのようです。</p>
<pre><code class="language-sh">[[ <span class="hljs-variable">$TERM</span> == <span class="hljs-string">&quot;dumb&quot;</span> ]] &amp;&amp; <span class="hljs-built_in">unsetopt</span> <span class="hljs-built_in">zle</span> &amp;&amp; PS1=<span class="hljs-string">&#x27;$ &#x27;</span> &amp;&amp; <span class="hljs-built_in">return</span>
</code></pre>
<p>もう一点上級者向けっぽいことを書くと、システムグローバルな設定のままControlMasterを使うようにカスタマイズする場合、Emacsで最初にshared connectionを開いてからターミナルなどでsshセッションを開き、Emacsを終了するとターミナルの方も同時に落ちる、というようなことになる場合があります。
このへんは好き好きというか、一般にどうするのがよいのか不明です。
カスタマイズしなければ関係ないですが。</p>
<h2 id="結論：便利なので使いましょう">結論：便利なので使いましょう</h2>
<p>というわけで画像もなくずらずらと使い方を書いてみました。
本当にstraightforwardなのでとくに説明することもないですね。インストールもないし。
ご存知なかった方はぜひぜひ使い倒してみてください。
ではでは。</p>
<h2 id="ところで関係ないけど">ところで関係ないけど</h2>
<p>Emacs 24.5で <code>;;;###tramp-autoload</code> にバグがあるような気がするのですがHEADで再現しないのでどこかに報告したほうがいいのかどうなのか分からずにいる。
具体的には</p>
<x-script src="https://gist.github.com/kissge/a9f1c59959181856280f.js"></x-script><p>を使って</p>
<pre><code class="language-sh">emacs -q -l init.el
</code></pre>
<p>などとして起動した後</p>
<pre><code>C-h v tramp-verbose
</code></pre>
<p>とすると設定通り変数が変更されているのが確認できるが</p>
<pre><code>C-h v tramp-use-ssh-controlmaster-options
</code></pre>
<p>とするとデフォルトの設定で上書きされている。
<code>tramp-use-ssh-controlmaster-options</code> 以外にも <code>;;;###tramp-autoload</code> が指定されている変数で同様の現象が確認できる。</p>
<!-- HTML_TAG_END --></section>

    <section class="links-section svelte-6mvvsp"><ul class="links"><li class="link-group"><h1 class="link-group-title">この記事がリンクしているもの</h1>
      <ul class="link-group-links"><li class="link"><a sveltekit:prefetch href="/mono/%E6%97%A5%E6%9C%AC%E8%AA%9E">日本語
              </a>
            
            <span class="tags"></span>
            <p></p>
          </li><li class="link"><a sveltekit:prefetch href="/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC">アドベントカレンダー
              </a>
            
            <span class="tags"></span>
            <p></p>
          </li></ul>
    </li><li class="link-group"><h1 class="link-group-title">この記事にリンクしているもの</h1>
      <ul class="link-group-links"><li class="link"><a sveltekit:prefetch href="/notes/emacs-windows-2017">Emacs: Windowsでやっていく2017
              </a>
            <small title="Fri Dec 08 2017 00:00:08 GMT+0000 (Coordinated Universal Time)"><time>2017-12-08</time>
              </small>
            <span class="tags"><a sveltekit:prefetch href="/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC" class="tag svelte-k4uca" data-kind="tag">アドベントカレンダー</a>
  </span>
            <p></p>
          </li></ul>
    </li><li class="link-group"><h1 class="link-group-title">日本語にリンクしているもの</h1>
      <ul class="link-group-links"><li class="link"><a sveltekit:prefetch href="/memorandum/%E3%83%AA%E3%83%90%E3%83%BC%E3%82%B7%E3%83%96%E3%83%AB%E3%81%AA%E4%BA%8C%E5%AD%97%E7%86%9F%E8%AA%9E">リバーシブルな二字熟語
              </a>
            
            <span class="tags"><a sveltekit:prefetch href="/mono/%E5%82%99%E5%BF%98%E9%8C%B2" class="tag svelte-k4uca" data-kind="tag">備忘録</a>
  </span>
            <p></p>
          </li><li class="link"><a sveltekit:prefetch href="/notes/how-do-japanese-type">How do Japanese type?
              </a>
            <small title="Sun May 29 2022 01:00:00 GMT+0000 (Coordinated Universal Time)"><time>2022-05-29</time>
              </small>
            <span class="tags"></span>
            <p></p>
          </li><li class="link"><a sveltekit:prefetch href="/notes/cldr">ja-JP-u-ca-japaneseって何？ UnicodeのCLDRを読んでみよう（あるいは、JavaScriptで和暦を得る簡単なテクについて）
              </a>
            <small title="Sat Feb 19 2022 02:41:00 GMT+0000 (Coordinated Universal Time)"><time>2022-02-19</time>
              </small>
            <span class="tags"><a sveltekit:prefetch href="/mono/Unicode" class="tag svelte-k4uca" data-kind="tag">Unicode</a>
  </span>
            <p></p>
          </li><li class="link"><a sveltekit:prefetch href="/notes/emacs-windows-2017">Emacs: Windowsでやっていく2017
              </a>
            <small title="Fri Dec 08 2017 00:00:08 GMT+0000 (Coordinated Universal Time)"><time>2017-12-08</time>
              </small>
            <span class="tags"><a sveltekit:prefetch href="/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC" class="tag svelte-k4uca" data-kind="tag">アドベントカレンダー</a>
  </span>
            <p></p>
          </li></ul>
    </li><li class="link-group"><h1 class="link-group-title">アドベントカレンダーにリンクしているもの</h1>
      <ul class="link-group-links"><li class="link"><a sveltekit:prefetch href="/notes/pdf-publisher-and-me">PDFと、出版社と、私
              </a>
            <small title="Thu Dec 23 2021 05:00:00 GMT+0000 (Coordinated Universal Time)"><time>2021-12-23</time>
              </small>
            <span class="tags"></span>
            <p></p>
          </li><li class="link"><a sveltekit:prefetch href="/notes/legalscape-tech-stack">リーガルリサーチシステム「Legalscape」の技術スタック2021
              </a>
            <small title="Thu Dec 02 2021 00:00:00 GMT+0000 (Coordinated Universal Time)"><time>2021-12-02</time>
              </small>
            <span class="tags"></span>
            <p></p>
          </li><li class="link"><a sveltekit:prefetch href="/notes/crowdfunding-vue">来年こそは届いてほしいスマートグラス「Vue」
              </a>
            <small title="Thu Dec 13 2018 00:17:07 GMT+0000 (Coordinated Universal Time)"><time>2018-12-13</time>
              </small>
            <span class="tags"></span>
            <p></p>
          </li><li class="link"><a sveltekit:prefetch href="/notes/emacs-windows-2017">Emacs: Windowsでやっていく2017
              </a>
            <small title="Fri Dec 08 2017 00:00:08 GMT+0000 (Coordinated Universal Time)"><time>2017-12-08</time>
              </small>
            <span class="tags"></span>
            <p></p>
          </li><li class="link"><a sveltekit:prefetch href="/notes/foreign-regexp-el">Emacs: re-builder + foreign-regexp.elでたのしい正規表現
              </a>
            <small title="Fri Dec 19 2014 23:30:53 GMT+0000 (Coordinated Universal Time)"><time>2014-12-20</time>
              </small>
            <span class="tags"></span>
            <p></p>
          </li></ul>
    </li></ul></section>

    <section class="mentions svelte-19gm1ik"><section class="reaction svelte-19gm1ik"><a href="https://twitter.com/intent/tweet?url=" class="svelte-19gm1ik" style="background-image: url(/_app/immutable/assets/message-circle-c0b45d48.svg); color: #3579d1;"><small class="svelte-19gm1ik">Twitterで</small>
        <span class="svelte-19gm1ik">コメントする</span></a></section>

  <h1 class="svelte-19gm1ik">Mentions</h1>
  <ol reversed class="svelte-19gm1ik loading"></ol>
</section></article>
</main>

<footer>Built with <a href="https://github.com/kissge/monolog">monolog</a>
</footer>


		<script type="module" data-sveltekit-hydrate="1gtnvkb">
		import { start } from "/_app/immutable/start-1fea0f3b.js";
		start({
			target: document.querySelector('[data-sveltekit-hydrate="1gtnvkb"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "always",
			hydrate: {
				status: 200,
				error: null,
				nodes: [0, 2],
				params: {entity:"notes\u002Ftramp-mode\u002F"},
				routeId: "[...entity]"
			}
		});
	</script><script type="application/json" sveltekit:data-type="props">{"entity":{"name":"Emacs: まだターミナルで消耗してるの？","nameSegmented":["Emacs: まだ","ターミナルで","消耗してるの？"],"kind":"note","urlPath":"/notes/tramp-mode","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/notes/tramp-mode.md","lastModified":"2022-06-11T07:33:39.000Z","attributes":{"from":"wordpress","title":"Emacs: まだターミナルで消耗してるの？","date":"2015-12-04T23:00:02.000Z","tags":["アドベントカレンダー"]},"tags":[{"name":"アドベントカレンダー","kind":"tag","urlPath":"/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC"}],"body":"\u003Cp>この記事は\u003Ca href=\"http://qiita.com/advent-calendar/2015/emacs\">Emacs Advent Calendar 2015\u003C/a>の第5日目の記事として書かれました。\n第4日目は\u003Ca href=\"http://qiita.com/niku\">niku\u003C/a>さんによる記事の予定です。「org-babelについて書くかも」とのこと。\n第6日目は\u003Ca href=\"http://qiita.com/takaxp\">takaxp\u003C/a>さんによる記事の予定です。「何も書かずに2015年を終えられると思うほど堕落してはおらんっ」とのこと。\u003C/p>\n\u003C!--more-->\n\n\u003Ch2 id=\"ずいぶんとダサい開発をしているのね\">ずいぶんとダサい開発をしているのね\u003C/h2>\n\u003Cp>所属柄私の周りには少なくないEmacsユーザがいるのに、だれも \u003Ccode>tramp-mode\u003C/code> のことを知らないようでここ数ヶ月で2、3回同じことを説明するはめになったのでついでにここにも書くことにします。\n初心者に説明する意図での記述なのでコアなユーザの方には物足りないものかもしれません。\u003C/p>\n\u003Cp>さてみなさん普段GUIでEmacs使ってますか？\n使ってるのにときどきCUIを使わざるを得ないという状況に陥りますか？\nだいたいそういうケースは次のどちらかのパターンなのではないでしょうか。\u003C/p>\n\u003Col>\n\u003Cli>rootとしてファイルを開きたい（\u003Ccode>sudo\u003C/code> したい）とき\u003C/li>\n\u003Cli>ssh先のサーバ上でファイルを編集したいとき\u003C/li>\n\u003C/ol>\n\u003Cp>まあどちらもままあることです。2. に至っては「手元（ローカル）のEmacsとで設定ファイルが共有されていないから不便／共有するのが面倒」なんてことになってませんか？よくないやつですね。\nこういった問題を全て解決する簡単な方法のひとつが \u003Ccode>tramp-mode\u003C/code> です。\u003C/p>\n\u003Ch2 id=\"tramp-mode-で-sudo-してみる\">\u003Ccode>tramp-mode\u003C/code> で \u003Ccode>sudo\u003C/code> してみる\u003C/h2>\n\u003Cp>というわけで幾つかの使用例を見てみましょう。\n\u003Ccode>tramp-mode\u003C/code> はいま普通にEmacsを使っているユーザの大半の環境では最初から入っているかと思いますが、22.1より古いバージョンを使っている方が万が一いればEmacsをバージョンアップしてください。\u003C/p>\n\u003Cp>たとえば \u003Ccode>/etc/httpd/conf/httpd.conf\u003C/code> を開くとき、普通に開くとread-onlyとなり\u003C/p>\n\u003Cpre>\u003Ccode>Note: file is write protected\n\u003C/code>\u003C/pre>\n\u003Cp>と怒られるかと思います。これをrootとして開くには次のように\u003C/p>\n\u003Cpre>\u003Ccode>C-x C-f /sudo::/etc/httpd/conf/httpd.conf\n\u003C/code>\u003C/pre>\n\u003Cp>と \u003Ccode>find-file\u003C/code> に渡すパスの前に \u003Ccode>/sudo::\u003C/code> を追加するだけです。\n\u003Ccode>/su::\u003C/code> なら更に短縮できますね（挙動の違いは見てお分かりの通りです）。\u003C/p>\n\u003Ch2 id=\"tramp-mode-でssh先のサーバ上のファイルを編集してみる\">\u003Ccode>tramp-mode\u003C/code> でssh先のサーバ上のファイルを編集してみる\u003C/h2>\n\u003Cp>同じように、sshで接続できる外部サーバ上のファイルを開くには\u003C/p>\n\u003Cpre>\u003Ccode>C-x C-f /user@example.com:path/to/file\n\u003C/code>\u003C/pre>\n\u003Cp>です。ユーザ名とホスト名のあとは \u003Ccode>/\u003C/code> からはじめてフルパスを書くか、あるいは \u003Ccode>$HOME\u003C/code> からの相対パスを書くことが出来ます。\n実はこの記法は接続メソッドが自動でデフォルトで補われているもので、次の略記です。\u003C/p>\n\u003Cpre>\u003Ccode>/scp:user@example.com:path/to/file\n\u003C/code>\u003C/pre>\n\u003Cp>この \u003Ccode>scp\u003C/code> はいくつかある接続メソッドの一つです。\nメソッドを省略した場合は \u003Ccode>tramp-default-method\u003C/code> という変数の内容を見て決定されます。\nEmacs 24.3くらいまではこの変数のデフォルト値は \u003Ccode>scpc\u003C/code> だったような気がしますが廃止されました。\n\u003Ccode>scp\u003C/code> では基本的にホストとの接続はsshで行われ、ファイルの転送はscpで行われます。\n頻繁にファイルを開いたり閉じたりする場合にはscpのオーバヘッドが効いて、すべてsshで行う \u003Ccode>ssh\u003C/code> というメソッドのほうが速い場合もあります。\u003C/p>\n\u003Cp>ちなみに \u003Ccode>shell\u003C/code> も開けるし \u003Ccode>compile\u003C/code> だって出来ます。便利〜\u003C/p>\n\u003Ch2 id=\"ssh先からsshした先のファイルを編集する\">ssh先からsshした先のファイルを編集する\u003C/h2>\n\u003Cp>何だか\u003Ca href=\"/mono/%E6%97%A5%E6%9C%AC%E8%AA%9E\" class=\"monolog-link\" sveltekit:prefetch title=\"日本語\">日本語\u003C/a>が怪しいですが、いわゆる踏み台サーバみたいなものが中間にある状況です。これもままあるかとおもいます。\nもっともよい解決策はsshのconfigに \u003Ccode>ProxyCommand\u003C/code> を設定することでこのホップを自動で行わせることでしょう。\nたとえば \u003Ccode>example1.com\u003C/code> に繋ぐために \u003Ccode>example2.com\u003C/code> に一旦繋ぐ必要がある場合には、sshのconfig（たとえば \u003Ccode>~/.ssh/config\u003C/code> ）に\u003C/p>\n\u003Cpre>\u003Ccode>Host example1\n    HostName example1.com\n    ProxyCommand ssh example2 -W %h:%p 2&gt; /dev/null\nHost example2\n    HostName example2.com\n\u003C/code>\u003C/pre>\n\u003Cp>などと書くことでターミナルから\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-sh\">$ ssh example1\n\u003C/code>\u003C/pre>\n\u003Cp>だけで一発で目的のホストに繋ぐことが出来ます。この設定をしているときにはEmacsで\u003C/p>\n\u003Cpre>\u003Ccode>C-x C-f /example1:path/to/file\n\u003C/code>\u003C/pre>\n\u003Cp>とするとこのホップを裏で自動で行ってもらうことが出来ます。\u003C/p>\n\u003Cp>もう一つの方法は \u003Ccode>tramp-mode\u003C/code> で明示的にホップさせることです。\nおそらくいま使われているような最近のバージョン (24.3以降) ですと\u003C/p>\n\u003Cpre>\u003Ccode>C-x C-f /ssh:example2.com|ssh:example1.com:path/to/file\n\u003C/code>\u003C/pre>\n\u003Cp>で同じことが出来るかと思います。\u003C/p>\n\u003Ch2 id=\"ssh先でsudoする\">ssh先でsudoする\u003C/h2>\n\u003Cp>ここまで読むともう次に何をするかはおわかりでしょう。実際ssh先でroot権限でファイルを読むこともよくありますよね。\u003C/p>\n\u003Cpre>\u003Ccode>C-x C-f /ssh:user@example.com|sudo:example.com:/etc/httpd/conf/httpd.conf\n\u003C/code>\u003C/pre>\n\u003Ch2 id=\"陥りがちなトラップ\">陥りがちなトラップ\u003C/h2>\n\u003Cp>いくつか注意点のようなもの。\u003C/p>\n\u003Cp>ホップして踏み台越しの接続をするときに \u003Ccode>/ssh:foo|sudo:foo:/etc/...\u003C/code> のように \u003Ccode>ssh\u003C/code> を省略することは出来ません。\n上述のようにこの場合デフォルトの \u003Ccode>scp\u003C/code> が使用されますが、このメソッドはホップに対応していません。\nまた、\u003Ccode>sudo::\u003C/code> とホストを省略する記法もここでは使えません。\u003C/p>\n\u003Cp>また、 \u003Ccode>tramp-mode\u003C/code> で繋ぐ先のホストのログインシェルがzshの場合、接続がうまくいかない場合があります。\nよく見受けられる対処法（私も使っています）は、 \u003Ccode>.zshrc\u003C/code> の1行目にEmacsからの接続を識別する場合分けを追加することのようです。\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-sh\">[[ \u003Cspan class=\"hljs-variable\">$TERM\u003C/span> == \u003Cspan class=\"hljs-string\">&quot;dumb&quot;\u003C/span> ]] &amp;&amp; \u003Cspan class=\"hljs-built_in\">unsetopt\u003C/span> \u003Cspan class=\"hljs-built_in\">zle\u003C/span> &amp;&amp; PS1=\u003Cspan class=\"hljs-string\">&#x27;$ &#x27;\u003C/span> &amp;&amp; \u003Cspan class=\"hljs-built_in\">return\u003C/span>\n\u003C/code>\u003C/pre>\n\u003Cp>もう一点上級者向けっぽいことを書くと、システムグローバルな設定のままControlMasterを使うようにカスタマイズする場合、Emacsで最初にshared connectionを開いてからターミナルなどでsshセッションを開き、Emacsを終了するとターミナルの方も同時に落ちる、というようなことになる場合があります。\nこのへんは好き好きというか、一般にどうするのがよいのか不明です。\nカスタマイズしなければ関係ないですが。\u003C/p>\n\u003Ch2 id=\"結論：便利なので使いましょう\">結論：便利なので使いましょう\u003C/h2>\n\u003Cp>というわけで画像もなくずらずらと使い方を書いてみました。\n本当にstraightforwardなのでとくに説明することもないですね。インストールもないし。\nご存知なかった方はぜひぜひ使い倒してみてください。\nではでは。\u003C/p>\n\u003Ch2 id=\"ところで関係ないけど\">ところで関係ないけど\u003C/h2>\n\u003Cp>Emacs 24.5で \u003Ccode>;;;###tramp-autoload\u003C/code> にバグがあるような気がするのですがHEADで再現しないのでどこかに報告したほうがいいのかどうなのか分からずにいる。\n具体的には\u003C/p>\n\u003Cx-script src=\"https://gist.github.com/kissge/a9f1c59959181856280f.js\">\u003C/x-script>\u003Cp>を使って\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-sh\">emacs -q -l init.el\n\u003C/code>\u003C/pre>\n\u003Cp>などとして起動した後\u003C/p>\n\u003Cpre>\u003Ccode>C-h v tramp-verbose\n\u003C/code>\u003C/pre>\n\u003Cp>とすると設定通り変数が変更されているのが確認できるが\u003C/p>\n\u003Cpre>\u003Ccode>C-h v tramp-use-ssh-controlmaster-options\n\u003C/code>\u003C/pre>\n\u003Cp>とするとデフォルトの設定で上書きされている。\n\u003Ccode>tramp-use-ssh-controlmaster-options\u003C/code> 以外にも \u003Ccode>;;;###tramp-autoload\u003C/code> が指定されている変数で同様の現象が確認できる。\u003C/p>\n","headline":"この記事はEmacs Advent Calendar 2015の第5日目の記事として書かれました。第4日目はnikuさんによる記事の予定です。「org-babelについて書くかも」とのこと。第6日目はtakaxpさんによる記事の予定です。「何も書かずに2015年を終えられると思うほど堕落してはおらんっ」とのこと。ずいぶんとダサい開発をしているのね所属柄私の周りには少なくないEmacsユーザがいるのに、だれも tramp-mode のことを知らないようでここ数ヶ月で2、3回同じことを説明するはめになったのでついでにここにも書くことにします。初心者に説明する意図での記述なのでコアなユーザの方には物足りないものかもしれません。さてみなさん普段GUIでEmacs使ってますか？使ってるのにときどきCUIを使わざるを得ないという状況に陥りますか？だいたいそういうケースは次のどちらかのパターンなのではないでしょうか。rootとしてファイルを開きたい（sudo したい）ときssh先のサーバ上でファイルを編集したいときまあどちらもままあることです。2. に至っては「手元（ローカル）のEmacsとで設定ファイルが共有されていない","links":{"to":{"urlPath":"/notes/tramp-mode","entities":[{"name":"日本語","nameSegmented":["日本語"],"kind":"tag","urlPath":"/mono/%E6%97%A5%E6%9C%AC%E8%AA%9E","tags":[]},{"name":"アドベントカレンダー","nameSegmented":["アドベントカレンダー"],"kind":"tag","urlPath":"/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC","tags":[]}]},"from":{"urlPath":"/notes/tramp-mode","entities":[{"name":"Emacs: Windowsでやっていく2017","nameSegmented":["Emacs: ","Windowsで","やっていく","2017"],"kind":"note","urlPath":"/notes/emacs-windows-2017","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/notes/emacs-windows-2017.md","lastModified":"2022-07-02T05:00:46.000Z","attributes":{"from":"wordpress","title":"Emacs: Windowsでやっていく2017","date":"2017-12-08T00:00:08.000Z","tags":["アドベントカレンダー"]},"tags":[{"name":"アドベントカレンダー","kind":"tag","urlPath":"/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC"}]}]},"kind":{"urlPath":"/notes/tramp-mode","entities":[]},"one_hop_日本語":{"urlPath":"/mono/%E6%97%A5%E6%9C%AC%E8%AA%9E","entities":[{"name":"リバーシブルな二字熟語","nameSegmented":["リバーシブルな","二字熟語"],"urlPath":"/memorandum/%E3%83%AA%E3%83%90%E3%83%BC%E3%82%B7%E3%83%96%E3%83%AB%E3%81%AA%E4%BA%8C%E5%AD%97%E7%86%9F%E8%AA%9E","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/memorandum/リバーシブルな二字熟語.md","lastModified":"2022-06-12T03:43:05.000Z","attributes":{"tags":["備忘録","日本語"]},"tags":[{"name":"備忘録","kind":"tag","urlPath":"/mono/%E5%82%99%E5%BF%98%E9%8C%B2"},{"name":"日本語","kind":"tag","urlPath":"/mono/%E6%97%A5%E6%9C%AC%E8%AA%9E"}]},{"name":"How do Japanese type?","nameSegmented":["How"," do ","Japanese"," type?"],"kind":"note","urlPath":"/notes/how-do-japanese-type","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/notes/how-do-japanese-type.md","lastModified":"2022-06-11T11:32:30.000Z","attributes":{"title":"How do Japanese type?","date":"2022-05-29T01:00:00.000Z","lang":"en","tags":["日本語"]},"tags":[{"name":"日本語","kind":"tag","urlPath":"/mono/%E6%97%A5%E6%9C%AC%E8%AA%9E"}]},{"name":"ja-JP-u-ca-japaneseって何？ UnicodeのCLDRを読んでみよう（あるいは、JavaScriptで和暦を得る簡単なテクについて）","nameSegmented":["ja-","JP","-u","-ca-","japaneseって","何？"," Unicodeの","CLDRを","読んでみよう","（あるいは、","JavaScriptで","和暦を","得る","簡単な","テクに","ついて）"],"kind":"note","urlPath":"/notes/cldr","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/notes/cldr.md","lastModified":"2022-06-11T11:32:20.000Z","attributes":{"title":"ja-JP-u-ca-japaneseって何？ UnicodeのCLDRを読んでみよう（あるいは、JavaScriptで和暦を得る簡単なテクについて）","date":"2022-02-19T02:41:00.000Z","tags":["Unicode"]},"tags":[{"name":"Unicode","kind":"tag","urlPath":"/mono/Unicode"}]},{"name":"Emacs: Windowsでやっていく2017","nameSegmented":["Emacs: ","Windowsで","やっていく","2017"],"kind":"note","urlPath":"/notes/emacs-windows-2017","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/notes/emacs-windows-2017.md","lastModified":"2022-07-02T05:00:46.000Z","attributes":{"from":"wordpress","title":"Emacs: Windowsでやっていく2017","date":"2017-12-08T00:00:08.000Z","tags":["アドベントカレンダー"]},"tags":[{"name":"アドベントカレンダー","kind":"tag","urlPath":"/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC"}]}]},"one_hop_アドベントカレンダー":{"urlPath":"/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC","entities":[{"name":"PDFと、出版社と、私","nameSegmented":["PDFと、","出版社と、","私"],"kind":"note","urlPath":"/notes/pdf-publisher-and-me","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/notes/pdf-publisher-and-me.md","lastModified":"2022-06-11T07:33:39.000Z","attributes":{"title":"PDFと、出版社と、私","date":"2021-12-23T05:00:00.000Z","tags":["アドベントカレンダー"]},"tags":[{"name":"アドベントカレンダー","kind":"tag","urlPath":"/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC"}]},{"name":"リーガルリサーチシステム「Legalscape」の技術スタック2021","nameSegmented":["リーガルリサーチシステム","「Legalscape」の","技術スタック","2021"],"kind":"note","urlPath":"/notes/legalscape-tech-stack","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/notes/legalscape-tech-stack.md","lastModified":"2022-06-11T07:33:39.000Z","attributes":{"title":"リーガルリサーチシステム「Legalscape」の技術スタック2021","date":"2021-12-02T00:00:00.000Z","tags":["アドベントカレンダー"]},"tags":[{"name":"アドベントカレンダー","kind":"tag","urlPath":"/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC"}]},{"name":"来年こそは届いてほしいスマートグラス「Vue」","nameSegmented":["来年","こそは","届いて","ほしい","スマートグラス","「Vue」"],"kind":"note","urlPath":"/notes/crowdfunding-vue","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/notes/crowdfunding-vue.md","lastModified":"2022-06-11T07:34:19.000Z","attributes":{"from":"wordpress","title":"来年こそは届いてほしいスマートグラス「Vue」","date":"2018-12-13T00:17:07.000Z","tags":["アドベントカレンダー"]},"tags":[{"name":"アドベントカレンダー","kind":"tag","urlPath":"/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC"}]},{"name":"Emacs: Windowsでやっていく2017","nameSegmented":["Emacs: ","Windowsで","やっていく","2017"],"kind":"note","urlPath":"/notes/emacs-windows-2017","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/notes/emacs-windows-2017.md","lastModified":"2022-07-02T05:00:46.000Z","attributes":{"from":"wordpress","title":"Emacs: Windowsでやっていく2017","date":"2017-12-08T00:00:08.000Z","tags":["アドベントカレンダー"]},"tags":[{"name":"アドベントカレンダー","kind":"tag","urlPath":"/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC"}]},{"name":"Emacs: re-builder + foreign-regexp.elでたのしい正規表現","nameSegmented":["Emacs: ","re","-builder"," +"," foreign","-regexp.","elで","たのしい","正規表現"],"kind":"note","urlPath":"/notes/foreign-regexp-el","historyURL":"https://github.com/kissge/yo.eki.do/commits/master/notes/foreign-regexp-el.md","lastModified":"2022-06-11T07:52:23.000Z","attributes":{"from":"wordpress","title":"Emacs: re-builder + foreign-regexp.elでたのしい正規表現","date":"2014-12-19T23:30:53.000Z","tags":["アドベントカレンダー"]},"tags":[{"name":"アドベントカレンダー","kind":"tag","urlPath":"/mono/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC"}]}]}}}}</script></div>
  </body>
</html>
