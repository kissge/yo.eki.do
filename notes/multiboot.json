{"from":"wordpress","title":"マルチブート覚書","date":"2015-11-03T23:49:51.000Z","slug":"multiboot","html":"<h1>Change the partition size</h1>\n<ol>\n<li>Use <code>gparted</code> from external disk (e.g., Ubuntu Live USB disk) and adjust partition sizes as you want.\n<ul>\n<li>note: <code>gparted</code> has bugs around handling HFS, so it behaves as if it has hung while it is moving a partition that contains HFS. <strong>Be patient and let it work</strong>. It may take more than 2 hours.</li>\n</ul>\n</li>\n<li>If Windows won’t boot after this, you have to either reconfigure legacy MBR or rebuild BCD.</li>\n</ol>\n<h1>Reconfigure MBR</h1>\n<ol>\n<li>Use <code>gptsync</code> from external disk.</li>\n</ol>\n<h1>Rebuild BCD</h1>\n<ol>\n<li>Use <code>fdisk</code> and mark Windows partition as active.\n<ul>\n<li>This activeness seems not exclusive; i.e. more than one partition can be active at the same time. I’m not sure this causes any problems.</li>\n</ul>\n</li>\n<li>Boot from Windows installation disk.</li>\n<li>Proceed to advance startup options and launch Command Prompt.</li>\n<li>Run <code>bootrec /RebuildBcd</code>. (you have to type <code>y</code> once, in most cases)</li>\n<li>Reactivate appropriate partition if necessary.</li>\n</ol>\n<h1>Restore initial bootloader</h1>\n<ol>\n<li>Copy first 446 bytes from another disk; e.g. <code>sudo dd if=/dev/sdc of=/dev/sda bs=446 count=1</code></li>\n</ol>\n"}